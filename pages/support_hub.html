<!DOCTYPE html>
<html lang="en">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>Support Hub - CargoWatch</title>
    <!-- Langue par défaut : anglais -->
    <script>
        (function() {
            const supportedLanguages = ['en', 'fr', 'es', 'de', 'pt', 'it', 'zh', 'ja', 'ru', 'ar'];
            let detectedLang = 'en'; // Par défaut : anglais
            
            // Vérifier si une préférence est sauvegardée
            try {
                const savedLang = localStorage.getItem('cargowatch_lang');
                if (savedLang && supportedLanguages.includes(savedLang)) {
                    detectedLang = savedLang;
                }
            } catch(e) {}
            
            document.documentElement.setAttribute('lang', detectedLang);
        })();
    </script>
    <link rel="stylesheet" href="../css/main.css">
    <link rel="preconnect" href="https://fonts.googleapis.com">
    <link rel="preconnect" href="https://fonts.gstatic.com" crossorigin>
    <script src="/socket.io/socket.io.js"></script>
    <script src="/public/i18n.js"></script>
    <script src="/public/init-i18n.js"></script>
  
  <script type="module" src="https://static.rocket.new/rocket-web.js?_cfg=https%3A%2F%2Fcargowatch6877back.builtwithrocket.new&_be=https%3A%2F%2Fapplication.rocket.new&_v=0.1.9"></script>
  <script type="module" src="https://static.rocket.new/rocket-shot.js?v=0.0.1"></script>
  </head>
<body class="bg-background">
    <!-- Smart Header with Navigation -->
    <header class="bg-white border-b border-border sticky top-0 z-50 shadow-soft">
        <div class="max-w-7xl mx-auto px-4 sm:px-6 lg:px-8">
            <div class="flex items-center justify-between h-16">
                <!-- Logo -->
                <div class="flex items-center">
                    <a href="homepage.html" class="flex items-center space-x-2">
                        <img src="/delivery-truck-logo.png" alt="CargoWatch Logo" class="w-8 h-8 object-contain">
                        <span class="text-xl font-bold text-primary">CargoWatch</span>
                    </a>
                </div>

                <!-- Navigation -->
                <nav class="hidden md:flex items-center space-x-8">
                    <a href="homepage.html" class="text-text-secondary hover:text-primary transition-colors">Home</a>
                    <a href="public_tracking_interface.html" class="text-text-secondary hover:text-primary transition-colors">Track Shipment</a>
                    <a href="shipment_creation_portal.html" class="text-text-secondary hover:text-primary transition-colors">Create Shipment</a>
                    <a href="support_hub.html" class="text-primary font-semibold">Support</a>
                </nav>

                <!-- Tracking Search Bar -->
                <div class="hidden lg:flex items-center space-x-4">
                    <div class="relative">
                        <input type="text" placeholder="Enter tracking ID..." class="input-field w-64 pl-10 pr-4 py-2">
                        <svg class="w-5 h-5 text-text-muted absolute left-3 top-1/2 transform -translate-y-1/2" fill="none" stroke="currentColor" viewBox="0 0 24 24">
                            <path stroke-linecap="round" stroke-linejoin="round" stroke-width="2" d="M21 21l-6-6m2-5a7 7 0 11-14 0 7 7 0 0114 0z"/>
                        </svg>
                    </div>
                    <a href="admin_dashboard.html" class="btn-primary hidden">Admin Login</a>
                </div>

                <!-- Mobile Menu Button -->
                <button class="md:hidden p-2 rounded-md text-text-secondary hover:text-primary">
                    <svg class="w-6 h-6" fill="none" stroke="currentColor" viewBox="0 0 24 24">
                        <path stroke-linecap="round" stroke-linejoin="round" stroke-width="2" d="M4 6h16M4 12h16M4 18h16"/>
                    </svg>
                </button>
            </div>
        </div>
    </header>

    <!-- Hero Section -->
    <section class="relative bg-gradient-to-br from-primary-50 to-secondary-50 py-16">
        <div class="max-w-7xl mx-auto px-4 sm:px-6 lg:px-8">
            <div class="text-center">
                <h1 class="text-4xl lg:text-5xl font-bold text-text-primary mb-6">
                    How can we <span class="text-gradient-primary">help you</span> today?
                </h1>
                <p class="text-xl text-text-secondary mb-8 max-w-3xl mx-auto">
                    Find answers, get support, and discover resources to make your shipping experience seamless.
                </p>
                
                <!-- Search Bar -->
                <div class="max-w-2xl mx-auto mb-8">
                    <div class="relative">
                        <input type="text" placeholder="Search for help articles, guides, or FAQs..." 
                               class="input-field w-full pl-12 pr-4 py-4 text-lg">
                        <svg class="w-6 h-6 text-text-muted absolute left-4 top-1/2 transform -translate-y-1/2" fill="none" stroke="currentColor" viewBox="0 0 24 24">
                            <path stroke-linecap="round" stroke-linejoin="round" stroke-width="2" d="M21 21l-6-6m2-5a7 7 0 11-14 0 7 7 0 0114 0z"/>
                        </svg>
                    </div>
                </div>

                <!-- Quick Actions -->
                <div class="flex flex-wrap justify-center gap-4">
                    <a href="#contact" class="btn-primary">Contact Support</a>
                    <a href="#status" class="btn-secondary">System Status</a>
                    <a href="#guides" class="bg-white text-primary border-2 border-primary px-6 py-3 rounded-lg font-semibold hover:bg-primary-50 transition-colors">
                        View Guides
                    </a>
                </div>
            </div>
        </div>
    </section>

    <!-- System Status Banner -->
    <section class="bg-success-50 border-b border-success-200">
        <div class="max-w-7xl mx-auto px-4 sm:px-6 lg:px-8 py-4">
            <div class="flex items-center justify-center space-x-3">
                <div class="w-3 h-3 bg-success rounded-full animate-pulse-soft"></div>
                <span class="text-success-700 font-medium">All systems operational</span>
                <span class="text-success-600 text-sm">Last updated: Nov 1, 2025 4:58 AM</span>
            </div>
        </div>
    </section>

    <!-- FAQ Section -->
    <section class="py-16 bg-surface">
        <div class="max-w-4xl mx-auto px-4 sm:px-6 lg:px-8">
            <div class="text-center mb-12">
                <h2 class="text-3xl font-bold text-text-primary mb-4">Frequently Asked Questions</h2>
                <p class="text-lg text-text-secondary">Quick answers to common questions</p>
            </div>

            <div class="space-y-6">
                <!-- FAQ Item 1 -->
                <div class="card">
                    <button class="w-full text-left flex items-center justify-between p-2" onclick="toggleFAQ(1)">
                        <h3 class="text-lg font-semibold text-text-primary">How do I track my shipment?</h3>
                        <svg id="faq-icon-1" class="w-5 h-5 text-text-muted transform transition-transform" fill="none" stroke="currentColor" viewBox="0 0 24 24">
                            <path stroke-linecap="round" stroke-linejoin="round" stroke-width="2" d="M19 9l-7 7-7-7"/>
                        </svg>
                    </button>
                    <div id="faq-content-1" class="hidden pt-4 pb-2">
                        <p class="text-text-secondary">Enter your tracking ID in the search bar at the top of any page or visit our dedicated tracking page. You'll see real-time updates, location information, and estimated delivery times.</p>
                    </div>
                </div>

                <!-- FAQ Item 2 -->
                <div class="card">
                    <button class="w-full text-left flex items-center justify-between p-2" onclick="toggleFAQ(2)">
                        <h3 class="text-lg font-semibold text-text-primary">What if my tracking ID isn't working?</h3>
                        <svg id="faq-icon-2" class="w-5 h-5 text-text-muted transform transition-transform" fill="none" stroke="currentColor" viewBox="0 0 24 24">
                            <path stroke-linecap="round" stroke-linejoin="round" stroke-width="2" d="M19 9l-7 7-7-7"/>
                        </svg>
                    </button>
                    <div id="faq-content-2" class="hidden pt-4 pb-2">
                        <p class="text-text-secondary">First, double-check the tracking ID for typos. If it's still not working, the shipment might not be in our system yet (this can take up to 24 hours). Contact support if the issue persists.</p>
                    </div>
                </div>

                <!-- FAQ Item 3 -->
                <div class="card">
                    <button class="w-full text-left flex items-center justify-between p-2" onclick="toggleFAQ(3)">
                        <h3 class="text-lg font-semibold text-text-primary">How accurate are delivery estimates?</h3>
                        <svg id="faq-icon-3" class="w-5 h-5 text-text-muted transform transition-transform" fill="none" stroke="currentColor" viewBox="0 0 24 24">
                            <path stroke-linecap="round" stroke-linejoin="round" stroke-width="2" d="M19 9l-7 7-7-7"/>
                        </svg>
                    </button>
                    <div id="faq-content-3" class="hidden pt-4 pb-2">
                        <p class="text-text-secondary">Our delivery estimates are accurate within 95% of cases. We use real-time traffic data, weather conditions, and historical delivery patterns to provide the most precise estimates possible.</p>
                    </div>
                </div>

                <!-- FAQ Item 4 -->
                <div class="card">
                    <button class="w-full text-left flex items-center justify-between p-2" onclick="toggleFAQ(4)">
                        <h3 class="text-lg font-semibold text-text-primary">Can I change my delivery address?</h3>
                        <svg id="faq-icon-4" class="w-5 h-5 text-text-muted transform transition-transform" fill="none" stroke="currentColor" viewBox="0 0 24 24">
                            <path stroke-linecap="round" stroke-linejoin="round" stroke-width="2" d="M19 9l-7 7-7-7"/>
                        </svg>
                    </button>
                    <div id="faq-content-4" class="hidden pt-4 pb-2">
                        <p class="text-text-secondary">Address changes are possible before the package is out for delivery. Contact our support team immediately with your tracking ID and new address. Additional fees may apply.</p>
                    </div>
                </div>

                <!-- FAQ Item 5 -->
                <div class="card">
                    <button class="w-full text-left flex items-center justify-between p-2" onclick="toggleFAQ(5)">
                        <h3 class="text-lg font-semibold text-text-primary">What happens if I miss my delivery?</h3>
                        <svg id="faq-icon-5" class="w-5 h-5 text-text-muted transform transition-transform" fill="none" stroke="currentColor" viewBox="0 0 24 24">
                            <path stroke-linecap="round" stroke-linejoin="round" stroke-width="2" d="M19 9l-7 7-7-7"/>
                        </svg>
                    </button>
                    <div id="faq-content-5" class="hidden pt-4 pb-2">
                        <p class="text-text-secondary">We'll leave a delivery notice and attempt redelivery the next business day. You can also schedule a specific delivery time or pick up your package at a nearby location through your tracking page.</p>
                    </div>
                </div>
            </div>
        </div>
    </section>

    <!-- Contact Support Section -->
                    </div>
                    <h3 class="text-lg font-semibold text-text-primary mb-2">How to Track Your First Shipment</h3>
                    <p class="text-text-secondary mb-4">Step-by-step guide to tracking your packages with CargoWatch, including mobile and web interfaces.</p>
                    <a href="javascript:void(0)" class="text-primary font-semibold hover:text-primary-700 transition-colors">Read Article →</a>
                </article>

                <!-- Article 2 -->
                <article class="card card-hover">
                    <img src="https://images.unsplash.com/photo-1590056783440-f00e4a1bd48b" 
                         alt="Professional packaging materials and boxes arranged for secure shipping preparation" 
                         class="w-full h-48 object-cover rounded-lg mb-4"
                         onerror="this.src='https://images.unsplash.com/photo-1584824486509-112e4181ff6b?q=80&w=2940&auto=format&fit=crop&ixlib=rb-4.0.3&ixid=M3wxMjA3fDB8MHxwaG90by1wYWdlfHx8fGVufDB8fHx8fA%3D%3D'; this.onerror=null;">
                    <div class="flex items-center space-x-2 mb-3">
                        <span class="status-warning">Shipping</span>
                        <span class="text-sm text-text-muted">8 min read</span>
                    </div>
                    <h3 class="text-lg font-semibold text-text-primary mb-2">Ultimate Packaging Guide</h3>
                    <p class="text-text-secondary mb-4">Learn professional packaging techniques to ensure your items arrive safely and securely.</p>
                    <a href="javascript:void(0)" class="text-primary font-semibold hover:text-primary-700 transition-colors">Read Article →</a>
                </article>

                <!-- Article 3 -->
                <article class="card card-hover">
                    <img src="https://images.unsplash.com/flagged/photo-1585418202849-7ce7e46e4ab6" 
                         alt="Digital map interface showing real-time GPS tracking routes and delivery status updates" 
                         class="w-full h-48 object-cover rounded-lg mb-4"
                         onerror="this.src='https://images.unsplash.com/photo-1584824486509-112e4181ff6b?q=80&w=2940&auto=format&fit=crop&ixlib=rb-4.0.3&ixid=M3wxMjA3fDB8MHxwaG90by1wYWdlfHx8fGVufDB8fHx8fA%3D%3D'; this.onerror=null;">
                    <div class="flex items-center space-x-2 mb-3">
                        <span class="status-success">Tracking</span>
                        <span class="text-sm text-text-muted">6 min read</span>
                    </div>
                    <h3 class="text-lg font-semibold text-text-primary mb-2">Understanding Delivery Statuses</h3>
                    <p class="text-text-secondary mb-4">Decode tracking statuses and know exactly what each update means for your shipment.</p>
                    <a href="javascript:void(0)" class="text-primary font-semibold hover:text-primary-700 transition-colors">Read Article →</a>
                </article>

                <!-- Article 4 -->
                <article class="card card-hover">
                    <img src="https://images.unsplash.com/photo-1538843427389-48d6e33e9b89" 
                         alt="International shipping documentation and customs forms for global package delivery" 
                         class="w-full h-48 object-cover rounded-lg mb-4"
                         onerror="this.src='https://images.unsplash.com/photo-1584824486509-112e4181ff6b?q=80&w=2940&auto=format&fit=crop&ixlib=rb-4.0.3&ixid=M3wxMjA3fDB8MHxwaG90by1wYWdlfHx8fGVufDB8fHx8fA%3D%3D'; this.onerror=null;">
                    <div class="flex items-center space-x-2 mb-3">
                        <span class="status-warning">International</span>
                        <span class="text-sm text-text-muted">12 min read</span>
                    </div>
                    <h3 class="text-lg font-semibold text-text-primary mb-2">International Shipping Regulations</h3>
                    <p class="text-text-secondary mb-4">Navigate customs, documentation, and regulations for successful international deliveries.</p>
                    <a href="javascript:void(0)" class="text-primary font-semibold hover:text-primary-700 transition-colors">Read Article →</a>
                </article>

                <!-- Article 5 -->
                <article class="card card-hover">
                    <img src="https://images.unsplash.com/photo-1623282033815-40b05d96c903" 
                         alt="Developer working on API integration code for CargoWatch tracking system" 
                         class="w-full h-48 object-cover rounded-lg mb-4"
                         onerror="this.src='https://images.unsplash.com/photo-1584824486509-112e4181ff6b?q=80&w=2940&auto=format&fit=crop&ixlib=rb-4.0.3&ixid=M3wxMjA3fDB8MHxwaG90by1wYWdlfHx8fGVufDB8fHx8fA%3D%3D'; this.onerror=null;">
                    <div class="flex items-center space-x-2 mb-3">
                        <span class="bg-primary-50 text-primary-700 border border-primary-200 px-3 py-1 rounded-full text-sm font-medium">API</span>
                        <span class="text-sm text-text-muted">15 min read</span>
                    </div>
                    <h3 class="text-lg font-semibold text-text-primary mb-2">API Integration Guide</h3>
                    <p class="text-text-secondary mb-4">Complete guide to integrating CargoWatch tracking into your existing systems and applications.</p>
                    <a href="javascript:void(0)" class="text-primary font-semibold hover:text-primary-700 transition-colors">Read Article →</a>
                </article>

                <!-- Article 6 -->
                <article class="card card-hover">
                    <img src="https://images.unsplash.com/photo-1686130475933-14626ca01acd" 
                         alt="Customer service representative helping client resolve shipping issue via live chat support" 
                         class="w-full h-48 object-cover rounded-lg mb-4"
                         onerror="this.src='https://images.unsplash.com/photo-1584824486509-112e4181ff6b?q=80&w=2940&auto=format&fit=crop&ixlib=rb-4.0.3&ixid=M3wxMjA3fDB8MHxwaG90by1wYWdlfHx8fGVufDB8fHx8fA%3D%3D'; this.onerror=null;">
                    <div class="flex items-center space-x-2 mb-3">
                        <span class="status-error">Troubleshooting</span>
                        <span class="text-sm text-text-muted">4 min read</span>
                    </div>
                    <h3 class="text-lg font-semibold text-text-primary mb-2">Common Tracking Issues</h3>
                    <p class="text-text-secondary mb-4">Quick solutions for the most common tracking problems and how to resolve them instantly.</p>
                    <a href="javascript:void(0)" class="text-primary font-semibold hover:text-primary-700 transition-colors">Read Article →</a>
                </article>
            </div>
        </div>
    </section>

    <!-- FAQ Section -->
    <section class="py-16 bg-surface">
        <div class="max-w-4xl mx-auto px-4 sm:px-6 lg:px-8">
            <div class="text-center mb-12">
                <h2 class="text-3xl font-bold text-text-primary mb-4">Frequently Asked Questions</h2>
                <p class="text-lg text-text-secondary">Quick answers to common questions</p>
            </div>

            <div class="space-y-6">
                <!-- FAQ Item 1 -->
                <div class="card">
                    <button class="w-full text-left flex items-center justify-between p-2" onclick="toggleFAQ(1)">
                        <h3 class="text-lg font-semibold text-text-primary">How do I track my shipment?</h3>
                        <svg id="faq-icon-1" class="w-5 h-5 text-text-muted transform transition-transform" fill="none" stroke="currentColor" viewBox="0 0 24 24">
                            <path stroke-linecap="round" stroke-linejoin="round" stroke-width="2" d="M19 9l-7 7-7-7"/>
                        </svg>
                    </button>
                    <div id="faq-content-1" class="hidden pt-4 pb-2">
                        <p class="text-text-secondary">Enter your tracking ID in the search bar at the top of any page or visit our dedicated tracking page. You'll see real-time updates, location information, and estimated delivery times.</p>
                    </div>
                </div>

                <!-- FAQ Item 2 -->
                <div class="card">
                    <button class="w-full text-left flex items-center justify-between p-2" onclick="toggleFAQ(2)">
                        <h3 class="text-lg font-semibold text-text-primary">What if my tracking ID isn't working?</h3>
                        <svg id="faq-icon-2" class="w-5 h-5 text-text-muted transform transition-transform" fill="none" stroke="currentColor" viewBox="0 0 24 24">
                            <path stroke-linecap="round" stroke-linejoin="round" stroke-width="2" d="M19 9l-7 7-7-7"/>
                        </svg>
                    </button>
                    <div id="faq-content-2" class="hidden pt-4 pb-2">
                        <p class="text-text-secondary">First, double-check the tracking ID for typos. If it's still not working, the shipment might not be in our system yet (this can take up to 24 hours). Contact support if the issue persists.</p>
                    </div>
                </div>

                <!-- FAQ Item 3 -->
                <div class="card">
                    <button class="w-full text-left flex items-center justify-between p-2" onclick="toggleFAQ(3)">
                        <h3 class="text-lg font-semibold text-text-primary">How accurate are delivery estimates?</h3>
                        <svg id="faq-icon-3" class="w-5 h-5 text-text-muted transform transition-transform" fill="none" stroke="currentColor" viewBox="0 0 24 24">
                            <path stroke-linecap="round" stroke-linejoin="round" stroke-width="2" d="M19 9l-7 7-7-7"/>
                        </svg>
                    </button>
                    <div id="faq-content-3" class="hidden pt-4 pb-2">
                        <p class="text-text-secondary">Our delivery estimates are accurate within 95% of cases. We use real-time traffic data, weather conditions, and historical delivery patterns to provide the most precise estimates possible.</p>
                    </div>
                </div>

                <!-- FAQ Item 4 -->
                <div class="card">
                    <button class="w-full text-left flex items-center justify-between p-2" onclick="toggleFAQ(4)">
                        <h3 class="text-lg font-semibold text-text-primary">Can I change my delivery address?</h3>
                        <svg id="faq-icon-4" class="w-5 h-5 text-text-muted transform transition-transform" fill="none" stroke="currentColor" viewBox="0 0 24 24">
                            <path stroke-linecap="round" stroke-linejoin="round" stroke-width="2" d="M19 9l-7 7-7-7"/>
                        </svg>
                    </button>
                    <div id="faq-content-4" class="hidden pt-4 pb-2">
                        <p class="text-text-secondary">Address changes are possible before the package is out for delivery. Contact our support team immediately with your tracking ID and new address. Additional fees may apply.</p>
                    </div>
                </div>

                <!-- FAQ Item 5 -->
                <div class="card">
                    <button class="w-full text-left flex items-center justify-between p-2" onclick="toggleFAQ(5)">
                        <h3 class="text-lg font-semibold text-text-primary">What happens if I miss my delivery?</h3>
                        <svg id="faq-icon-5" class="w-5 h-5 text-text-muted transform transition-transform" fill="none" stroke="currentColor" viewBox="0 0 24 24">
                            <path stroke-linecap="round" stroke-linejoin="round" stroke-width="2" d="M19 9l-7 7-7-7"/>
                        </svg>
                    </button>
                    <div id="faq-content-5" class="hidden pt-4 pb-2">
                        <p class="text-text-secondary">We'll leave a delivery notice and attempt redelivery the next business day. You can also schedule a specific delivery time or pick up your package at a nearby location through your tracking page.</p>
                    </div>
                </div>
            </div>
        </div>
    </section>

    <!-- Contact Support Section -->
    <section id="contact" class="py-16 bg-white">
        <div class="max-w-7xl mx-auto px-4 sm:px-6 lg:px-8">
            <div class="text-center mb-12">
                <h2 class="text-3xl font-bold text-text-primary mb-4">Still Need Help?</h2>
                <p class="text-lg text-text-secondary">Our support team is here to help you 24/7</p>
            </div>

            <div class="grid md:grid-cols-3 gap-8">
                <!-- Live Chat -->
                <div class="card card-hover text-center">
                    <div class="w-16 h-16 bg-primary-100 rounded-full flex items-center justify-center mx-auto mb-6">
                        <svg class="w-8 h-8 text-primary" fill="none" stroke="currentColor" viewBox="0 0 24 24">
                            <path stroke-linecap="round" stroke-linejoin="round" stroke-width="2" d="M8 12h.01M12 12h.01M16 12h.01M21 12c0 4.418-4.03 8-9 8a9.863 9.863 0 01-4.255-.949L3 20l1.395-3.72C3.512 15.042 3 13.574 3 12c0-4.418 4.03-8 9-8s9 3.582 9 8z"/>
                        </svg>
                    </div>
                    <h3 class="text-xl font-semibold text-text-primary mb-4">Live Chat</h3>
                    <p class="text-text-secondary mb-6">Get instant help from our support team. Average response time: 2 minutes.</p>
                    <div class="flex items-center justify-center space-x-2 mb-4">
                        <div class="w-3 h-3 bg-success rounded-full animate-pulse-soft"></div>
                        <span class="text-success-700 text-sm font-medium">12 agents online</span>
                    </div>
                    <button id="start-chat-btn" class="btn-primary w-full">Start Live Chat</button>
                </div>

                <!-- Email Support -->
                <div class="card card-hover text-center">
                    <div class="w-16 h-16 bg-accent-100 rounded-full flex items-center justify-center mx-auto mb-6">
                        <svg class="w-8 h-8 text-accent" fill="none" stroke="currentColor" viewBox="0 0 24 24">
                            <path stroke-linecap="round" stroke-linejoin="round" stroke-width="2" d="M3 8l7.89 4.26a2 2 0 002.22 0L21 8M5 19h14a2 2 0 002-2V7a2 2 0 00-2-2H5a2 2 0 00-2 2v10a2 2 0 002 2z"/>
                        </svg>
                    </div>
                    <h3 class="text-xl font-semibold text-text-primary mb-4">Email Support</h3>
                    <p class="text-text-secondary mb-6">Send us detailed questions and get comprehensive answers within 4 hours.</p>
                    <div class="text-sm text-text-muted mb-4">
                        uncledrewlegacy@gmail.com
                    </div>
                    <a href="mailto:uncledrewlegacy@gmail.com?subject=Support Request" class="btn-accent w-full inline-block text-center">Send Email</a>
                </div>

                <!-- Email Support Alternative -->
                <div class="card card-hover text-center">
                    <div class="w-16 h-16 bg-success-100 rounded-full flex items-center justify-center mx-auto mb-6">
                        <svg class="w-8 h-8 text-success" fill="none" stroke="currentColor" viewBox="0 0 24 24">
                            <path stroke-linecap="round" stroke-linejoin="round" stroke-width="2" d="M3 8l7.89 4.26a2 2 0 002.22 0L21 8M5 19h14a2 2 0 002-2V7a2 2 0 00-2-2H5a2 2 0 00-2 2v10a2 2 0 002 2z"/>
                        </svg>
                    </div>
                    <h3 class="text-xl font-semibold text-text-primary mb-4">Quick Support</h3>
                    <p class="text-text-secondary mb-6">Need immediate assistance? Send us an email and we'll get back to you quickly.</p>
                    <div class="text-sm text-text-muted mb-4">
                        24/7 Available
                    </div>
                    <a href="mailto:uncledrewlegacy@gmail.com?subject=Urgent Support Request" class="btn-secondary w-full inline-block text-center">Contact Now</a>
                </div>
            </div>
        </div>
    </section>

    <!-- System Status Section -->
    <section id="status" class="py-16 bg-surface">
        <div class="max-w-4xl mx-auto px-4 sm:px-6 lg:px-8">
            <div class="text-center mb-12">
                <h2 class="text-3xl font-bold text-text-primary mb-4">System Status</h2>
                <p class="text-lg text-text-secondary">Real-time status of all CargoWatch services</p>
            </div>

            <div class="space-y-4">
                <!-- Service Status Items -->
                <div class="card flex items-center justify-between">
                    <div class="flex items-center space-x-4">
                        <div class="w-4 h-4 bg-success rounded-full"></div>
                        <div>
                            <h3 class="font-semibold text-text-primary">Tracking API</h3>
                            <p class="text-sm text-text-secondary">Real-time package tracking</p>
                        </div>
                    </div>
                    <span class="status-success">Operational</span>
                </div>

                <div class="card flex items-center justify-between">
                    <div class="flex items-center space-x-4">
                        <div class="w-4 h-4 bg-success rounded-full"></div>
                        <div>
                            <h3 class="font-semibold text-text-primary">Notification Service</h3>
                            <p class="text-sm text-text-secondary">SMS and email alerts</p>
                        </div>
                    </div>
                    <span class="status-success">Operational</span>
                </div>

                <div class="card flex items-center justify-between">
                    <div class="flex items-center space-x-4">
                        <div class="w-4 h-4 bg-success rounded-full"></div>
                        <div>
                            <h3 class="font-semibold text-text-primary">Admin Dashboard</h3>
                            <p class="text-sm text-text-secondary">Management interface</p>
                        </div>
                    </div>
                    <span class="status-success">Operational</span>
                </div>

                <div class="card flex items-center justify-between">
                    <div class="flex items-center space-x-4">
                        <div class="w-4 h-4 bg-warning rounded-full"></div>
                        <div>
                            <h3 class="font-semibold text-text-primary">Mobile App</h3>
                            <p class="text-sm text-text-secondary">iOS and Android applications</p>
                        </div>
                    </div>
                    <span class="status-warning">Maintenance</span>
                </div>

                <div class="card flex items-center justify-between">
                    <div class="flex items-center space-x-4">
                        <div class="w-4 h-4 bg-success rounded-full"></div>
                        <div>
                            <h3 class="font-semibold text-text-primary">Website</h3>
                            <p class="text-sm text-text-secondary">Main website and tracking portal</p>
                        </div>
                    </div>
                    <span class="status-success">Operational</span>
                </div>
            </div>

            <!-- Status History -->
            <div class="mt-12">
                <h3 class="text-xl font-semibold text-text-primary mb-6">Recent Incidents</h3>
                <div class="space-y-4">
                    <div class="card">
                        <div class="flex items-start space-x-4">
                            <div class="w-3 h-3 bg-success rounded-full mt-2"></div>
                            <div class="flex-1">
                                <div class="flex items-center justify-between mb-2">
                                    <h4 class="font-semibold text-text-primary">Mobile App Maintenance Complete</h4>
                                    <span class="text-sm text-text-muted">Nov 1, 2025 3:30 AM</span>
                                </div>
                                <p class="text-text-secondary">Scheduled maintenance for mobile app performance improvements has been completed successfully.</p>
                            </div>
                        </div>
                    </div>

                    <div class="card">
                        <div class="flex items-start space-x-4">
                            <div class="w-3 h-3 bg-warning rounded-full mt-2"></div>
                            <div class="flex-1">
                                <div class="flex items-center justify-between mb-2">
                                    <h4 class="font-semibold text-text-primary">Brief API Slowdown</h4>
                                    <span class="text-sm text-text-muted">Oct 30, 2025 2:15 PM</span>
                                </div>
                                <p class="text-text-secondary">Tracking API experienced 15-minute slowdown due to high traffic. Issue resolved with additional server capacity.</p>
                            </div>
                        </div>
                    </div>
                </div>
            </div>
        </div>
    </section>

    <!-- Chat Bubble Widget - Modern Messaging Icon -->
    <div id="chat-bubble-widget" style="position: fixed; bottom: 20px; right: 20px; z-index: 9999; width: 64px; height: 64px;">
        <button id="chat-bubble-btn-support" aria-label="Open live chat support" style="width: 64px; height: 64px; border-radius: 50%; background: linear-gradient(135deg, #2563EB 0%, #1D4ED8 100%); color: white; border: none; box-shadow: 0 4px 20px rgba(37, 99, 235, 0.4), 0 8px 32px rgba(37, 99, 235, 0.2); display: flex; align-items: center; justify-content: center; cursor: pointer; transition: all 0.3s ease; position: relative; padding: 0;" onmouseover="this.style.transform='scale(1.1)'; this.style.boxShadow='0 6px 25px rgba(37, 99, 235, 0.5), 0 12px 40px rgba(37, 99, 235, 0.3)';" onmouseout="this.style.transform='scale(1)'; this.style.boxShadow='0 4px 20px rgba(37, 99, 235, 0.4), 0 8px 32px rgba(37, 99, 235, 0.2)';">
            <!-- Modern Message Icon -->
            <svg viewBox="0 0 24 24" fill="none" xmlns="http://www.w3.org/2000/svg" style="width: 32px; height: 32px;">
                <path d="M20 2H4C2.9 2 2 2.9 2 4V22L6 18H20C21.1 18 22 17.1 22 16V4C22 2.9 21.1 2 20 2Z" fill="currentColor" stroke="currentColor" stroke-width="1.5" stroke-linecap="round" stroke-linejoin="round"/>
                <path d="M7 9H17M7 13H14" stroke="white" stroke-width="1.5" stroke-linecap="round"/>
            </svg>
            <span id="chat-bubble-badge-support" class="absolute -top-1 -right-1 text-white text-xs rounded-full w-5 h-5 flex items-center justify-center hidden" style="position: absolute; top: -4px; right: -4px; background-color: #EF4444; min-width: 20px; height: 20px; border-radius: 50%; display: flex; align-items: center; justify-content: center; font-size: 11px; font-weight: 600; border: 2px solid white; box-shadow: 0 2px 8px rgba(239, 68, 68, 0.4);">0</span>
            <!-- Pulse Animation -->
            <div id="chat-bubble-pulse-support" style="position: absolute; inset: -4px; border-radius: 50%; background-color: #2563EB; opacity: 0.3; animation: pulse-ring 2s cubic-bezier(0.4, 0, 0.6, 1) infinite;"></div>
        </button>
    </div>
    <style>
        @keyframes pulse-ring {
            0% { transform: scale(1); opacity: 0.3; }
            50% { transform: scale(1.3); opacity: 0.1; }
            100% { transform: scale(1.5); opacity: 0; }
        }
        /* Responsive adjustments */
        @media (max-width: 640px) {
            #chat-bubble-widget {
                bottom: 16px !important;
                right: 16px !important;
                width: 56px !important;
                height: 56px !important;
            }
            #chat-bubble-btn-support {
                width: 56px !important;
                height: 56px !important;
            }
            #chat-bubble-btn-support svg {
                width: 28px !important;
                height: 28px !important;
            }
        }
    </style>

    <!-- Live Chat Widget -->
    <div id="chat-widget" class="fixed z-50 hidden" style="top: 20px; left: 20px; right: 20px; bottom: 20px; max-width: calc(100vw - 40px); max-height: calc(100vh - 40px);">
        <div id="chat-widget-container" class="bg-white rounded-lg shadow-2xl flex flex-col border border-border" style="width: 100%; height: 100%; overflow: hidden; display: flex; flex-direction: column;">
            <!-- Chat Header -->
            <div class="bg-primary text-white p-4 rounded-t-lg flex items-center justify-between" style="flex-shrink: 0;">
                <div class="flex items-center space-x-2">
                    <div class="w-3 h-3 bg-success rounded-full animate-pulse"></div>
                    <span class="font-semibold">Live Chat Support</span>
                </div>
                <button id="close-chat" class="text-white hover:text-gray-200">
                    <svg class="w-5 h-5" fill="none" stroke="currentColor" viewBox="0 0 24 24">
                        <path stroke-linecap="round" stroke-linejoin="round" stroke-width="2" d="M6 18L18 6M6 6l12 12"/>
                    </svg>
                </button>
            </div>
            
            <!-- Chat Start Form -->
            <div id="chat-start-form" class="p-4 space-y-4 flex-1" style="overflow-y: auto; overflow-x: hidden; min-height: 0; display: flex; flex-direction: column;">
                <div>
                    <label class="block text-sm font-medium text-text-primary mb-2">Your Name *</label>
                    <input type="text" id="client-name" class="input-field" placeholder="John Doe" required>
                </div>
                <div>
                    <label class="block text-sm font-medium text-text-primary mb-2">Your Email *</label>
                    <input type="email" id="client-email" class="input-field" placeholder="john@example.com" required>
                </div>
                <div>
                    <label class="block text-sm font-medium text-text-primary mb-2">Subject</label>
                    <input type="text" id="chat-subject" class="input-field" placeholder="How can we help?">
                </div>
                <div>
                    <label class="block text-sm font-medium text-text-primary mb-2">Tracking ID (Optional)</label>
                    <input type="text" id="chat-tracking-id" class="input-field" placeholder="CW20251101XXXXXX">
                </div>
                <button id="start-chat-form-btn" class="btn-primary w-full mt-auto">Start Chat</button>
            </div>
            
            <!-- Chat Messages Area -->
            <div id="chat-messages-container" class="hidden flex-1 flex flex-col" style="overflow: hidden; min-height: 0; display: flex; flex-direction: column;">
                <div id="chat-header-info" class="px-4 py-2 bg-surface border-b border-border" style="flex-shrink: 0;">
                    <p class="text-sm text-text-secondary" id="chat-subject-display"></p>
                </div>
                <div id="chat-messages" class="flex-1 p-4" style="overflow-y: auto !important; overflow-x: hidden !important; min-height: 0 !important; max-height: 100% !important; word-wrap: break-word !important; overflow-wrap: break-word !important; scrollbar-width: thin; scrollbar-color: #cbd5e0 #f7fafc; position: relative;">
                    <!-- Messages will be inserted here -->
                </div>
                <div class="border-t border-border p-4" style="flex-shrink: 0;">
                    <div class="flex items-center space-x-2">
                        <input type="text" id="chat-message-input" class="input-field flex-1" placeholder="Type your message...">
                        <button id="chat-send-btn" class="btn-primary px-4 py-2">Send</button>
                    </div>
                </div>
            </div>
        </div>
    </div>
    <style>
        /* Chat Widget Container - Force height for flexbox */
        #chat-widget-container {
            display: flex !important;
            flex-direction: column !important;
            overflow: hidden !important;
        }
        
        /* Chat Messages Container - Critical for scroll to work */
        #chat-messages-container {
            display: flex !important;
            flex-direction: column !important;
            overflow: hidden !important;
            min-height: 0 !important;
            flex: 1 1 0% !important;
            max-height: 100% !important;
        }
        
        /* Chat Messages - Scrollable area */
        #chat-messages {
            scrollbar-width: thin;
            scrollbar-color: #cbd5e0 #f7fafc;
            min-height: 0 !important;
            flex: 1 1 0% !important;
            overflow-y: auto !important;
            overflow-x: hidden !important;
            word-wrap: break-word !important;
            overflow-wrap: break-word !important;
            display: block !important;
            position: relative !important;
        }
        
        #chat-messages::-webkit-scrollbar {
            width: 8px;
        }
        
        #chat-messages::-webkit-scrollbar-track {
            background: #f7fafc;
            border-radius: 4px;
        }
        
        #chat-messages::-webkit-scrollbar-thumb {
            background: #cbd5e0;
            border-radius: 4px;
        }
        
        #chat-messages::-webkit-scrollbar-thumb:hover {
            background: #a0aec0;
        }
        
        /* Ensure messages don't overflow - CRITICAL */
        #chat-messages > div {
            word-wrap: break-word !important;
            overflow-wrap: break-word !important;
            max-width: 100% !important;
            min-width: 0 !important;
            width: 100% !important;
            box-sizing: border-box !important;
            display: block !important;
            margin-bottom: 0.75rem !important;
        }
        
        #chat-messages > div > div {
            max-width: 75% !important;
            width: fit-content !important;
            min-width: 0 !important;
            word-wrap: break-word !important;
            overflow-wrap: break-word !important;
            hyphens: auto;
            box-sizing: border-box !important;
            overflow: visible !important;
            display: inline-block !important;
        }
        
        /* For client messages aligned right */
        #chat-messages > div.justify-end > div {
            margin-left: auto !important;
            margin-right: 0 !important;
        }
        
        /* For admin messages aligned left */
        #chat-messages > div.justify-start > div {
            margin-left: 0 !important;
            margin-right: auto !important;
        }
        
        #chat-start-form {
            scrollbar-width: thin;
            scrollbar-color: #cbd5e0 #f7fafc;
        }
        
        #chat-start-form::-webkit-scrollbar {
            width: 8px;
        }
        
        #chat-start-form::-webkit-scrollbar-track {
            background: #f7fafc;
            border-radius: 4px;
        }
        
        #chat-start-form::-webkit-scrollbar-thumb {
            background: #cbd5e0;
            border-radius: 4px;
        }
        
        #chat-start-form::-webkit-scrollbar-thumb:hover {
            background: #a0aec0;
        }
        
        /* Mobile Responsive */
        @media (max-width: 640px) {
            #chat-widget {
                top: 10px !important;
                left: 10px !important;
                right: 10px !important;
                bottom: 10px !important;
                max-width: calc(100vw - 20px) !important;
                max-height: calc(100vh - 20px) !important;
            }
            
            #chat-widget > div {
                width: 100% !important;
                max-width: 100% !important;
                height: 100% !important;
            }
            
            #chat-messages > div > div {
                max-width: 85% !important;
            }
        }
    </style>

    <!-- Footer -->
    <footer class="bg-text-primary text-white py-16">
        <div class="max-w-7xl mx-auto px-4 sm:px-6 lg:px-8">
            <div class="grid md:grid-cols-4 gap-8">
                <!-- Company Info -->
                <div>
                    <div class="flex items-center space-x-2 mb-6">
                        <img src="/delivery-truck-logo.png" alt="CargoWatch Logo" class="w-8 h-8 object-contain">
                        <span class="text-xl font-bold">CargoWatch</span>
                    </div>
                    <p class="text-text-muted mb-4">Your cargo. Our watch. Every mile.</p>
                    <p class="text-sm text-text-muted">© 2025 CargoWatch. All Rights Reserved.</p>
                </div>

                <!-- Services -->
                <div>
                    <h4 class="font-semibold mb-4">Services</h4>
                    <ul class="space-y-2 text-sm text-text-muted">
                        <li><a href="public_tracking_interface.html" class="hover:text-white transition-colors">Package Tracking</a></li>
                        <li><a href="shipment_creation_portal.html" class="hover:text-white transition-colors">Create Shipment</a></li>
                        <li><a href="admin_dashboard.html" class="hover:text-white transition-colors hidden">Admin Dashboard</a></li>
                    </ul>
                </div>

                <!-- Support -->
                <div>
                    <h4 class="font-semibold mb-4">Support</h4>
                    <ul class="space-y-2 text-sm text-text-muted">
                        <li><a href="support_hub.html" class="hover:text-white transition-colors">Help Center</a></li>
                        <li><a href="support_hub.html" class="hover:text-white transition-colors">Contact Us</a></li>
                        <li><a href="support_hub.html" class="hover:text-white transition-colors">System Status</a></li>
                        <li><a href="support_hub.html" class="hover:text-white transition-colors">FAQ</a></li>
                    </ul>
                </div>

                <!-- Contact -->
                <div>
                    <h4 class="font-semibold mb-4">Contact</h4>
                    <ul class="space-y-2 text-sm text-text-muted">
                        <li>uncledrewlegacy@gmail.com</li>
                        <li>24/7 Customer Support</li>
                        <li>Enterprise Solutions</li>
                    </ul>
                </div>
            </div>
        </div>
    </footer>

    <script>
        function toggleFAQ(id) {
            const content = document.getElementById(`faq-content-${id}`);
            const icon = document.getElementById(`faq-icon-${id}`);
            
            if (content.classList.contains('hidden')) {
                content.classList.remove('hidden');
                icon.style.transform = 'rotate(180deg)';
            } else {
                content.classList.add('hidden');
                icon.style.transform = 'rotate(0deg)';
            }
        }

        // Smooth scrolling for anchor links
        document.querySelectorAll('a[href^="#"]').forEach(anchor => {
            anchor.addEventListener('click', function (e) {
                e.preventDefault();
                const target = document.querySelector(this.getAttribute('href'));
                if (target) {
                    target.scrollIntoView({
                        behavior: 'smooth',
                        block: 'start'
                    });
                }
            });
        });

        // Search functionality
        const searchInput = document.querySelector('input[placeholder*="Search for help"]');
        if (searchInput) {
            searchInput.addEventListener('keypress', function(e) {
                if (e.key === 'Enter') {
                    // Simulate search functionality
                    alert('Search functionality would be implemented here');
                }
            });
        }

        // Interactive tools functionality
        document.querySelectorAll('.btn-primary, .btn-accent, .btn-secondary').forEach(button => {
            if (button.textContent.includes('Calculate') || button.textContent.includes('Estimate') || button.textContent.includes('Get Advice')) {
                button.addEventListener('click', function(e) {
                    e.preventDefault();
                    // Simulate tool functionality
                    const tool = this.textContent;
                    alert(`${tool} functionality would be implemented here with real calculations`);
                });
            }
        });

        // ==================== LIVE CHAT FUNCTIONALITY ====================
        let socket = null;
        let currentChatId = null;

        // Initialize socket connection
        function initSocket() {
            try {
                socket = io(window.location.origin);
                
                socket.on('connect', () => {
                    console.log('✅ Connected to chat server');
                });
                
                socket.on('new-message', (data) => {
                    // Only process messages for the current chat to avoid duplicates
                    if (data.chatId === currentChatId) {
                        // Check if message already exists to prevent duplicates
                        const messagesContainer = document.getElementById('chat-messages');
                        if (messagesContainer) {
                            const existingMessage = messagesContainer.querySelector(`[data-message-id="${data.message.id}"]`);
                            if (!existingMessage) {
                                addMessageToChat(data.message);
                                scrollToBottom();
                            }
                        }
                    }
                });
                
                socket.on('chat-assigned', (data) => {
                    console.log('Chat assigned:', data);
                });
                
                socket.on('chat-closed', (data) => {
                    if (data.chatId === currentChatId) {
                        alert('This chat has been closed by an admin.');
                    }
                });
            } catch (error) {
                console.error('Error initializing socket:', error);
            }
        }

        // Load user info and pre-fill chat form
        async function loadUserInfoForChat() {
            try {
                const response = await fetch('/api/auth/me', { credentials: 'include' });
                if (response.ok) {
                    const data = await response.json();
                    if (data.user) {
                        // Pre-fill name field
                        const nameInput = document.getElementById('client-name');
                        if (nameInput) {
                            if (data.user.firstName && data.user.lastName) {
                                nameInput.value = `${data.user.firstName} ${data.user.lastName}`;
                            } else if (data.user.firstName) {
                                nameInput.value = data.user.firstName;
                            } else if (data.user.username) {
                                nameInput.value = data.user.username;
                            }
                            nameInput.readOnly = true; // Make it readonly since user is logged in
                        }
                        
                        // Pre-fill email field
                        const emailInput = document.getElementById('client-email');
                        if (emailInput && data.user.email) {
                            emailInput.value = data.user.email;
                            emailInput.readOnly = true; // Make it readonly since user is logged in
                        }
                    }
                }
            } catch (error) {
                console.log('User not logged in or error loading user info:', error);
            }
        }

        // Chat bubble button handler
        document.getElementById('chat-bubble-btn-support')?.addEventListener('click', () => {
            const chatWidget = document.getElementById('chat-widget');
            const chatBubble = document.getElementById('chat-bubble-widget');
            if (chatWidget.classList.contains('hidden')) {
                chatWidget.classList.remove('hidden');
                chatBubble.classList.add('hidden');
                initSocket();
                loadUserInfoForChat(); // Pre-fill user info when opening chat
            } else {
                chatWidget.classList.add('hidden');
                chatBubble.classList.remove('hidden');
            }
        });

        // Start chat button handlers - opens chat widget directly
        document.getElementById('start-chat-btn')?.addEventListener('click', () => {
            const chatWidget = document.getElementById('chat-widget');
            const chatBubble = document.getElementById('chat-bubble-widget');
            
            if (chatWidget && chatBubble) {
                // Open chat widget
                chatWidget.classList.remove('hidden');
                chatBubble.classList.add('hidden');
                
                // Initialize socket if not already done
                initSocket();
                
                // Pre-fill user info when opening chat
                loadUserInfoForChat();
                
                // Scroll to chat widget smoothly
                setTimeout(() => {
                    chatWidget.scrollIntoView({ behavior: 'smooth', block: 'end' });
                }, 100);
            }
        });

        document.getElementById('close-chat')?.addEventListener('click', () => {
            document.getElementById('chat-widget').classList.add('hidden');
            document.getElementById('chat-bubble-widget').classList.remove('hidden');
            if (socket) {
                socket.disconnect();
                socket = null;
            }
        });

        // Start chat form submission
        document.getElementById('start-chat-form-btn')?.addEventListener('click', async () => {
            const name = document.getElementById('client-name').value;
            const email = document.getElementById('client-email').value;
            const subject = document.getElementById('chat-subject').value || 'General Inquiry';
            const trackingId = document.getElementById('chat-tracking-id').value || null;

            if (!name || !email) {
                alert('Please enter your name and email');
                return;
            }

            try {
                const response = await fetch('/api/chat/start', {
                    method: 'POST',
                    headers: { 'Content-Type': 'application/json' },
                    body: JSON.stringify({ clientName: name, clientEmail: email, subject, trackingId })
                });

                if (!response.ok) throw new Error('Failed to start chat');

                const chat = await response.json();
                currentChatId = chat.id;
                
                // Join chat room
                if (socket) {
                    socket.emit('join-chat', currentChatId);
                }

                // Hide form and show chat
                document.getElementById('chat-start-form').classList.add('hidden');
                document.getElementById('chat-messages-container').classList.remove('hidden');
                document.getElementById('chat-subject-display').textContent = chat.subject;

                // Enforce height constraints when showing messages
                setTimeout(() => {
                    enforceChatHeight();
                }, 100);

                // Load existing messages
                loadChatMessages(currentChatId);
            } catch (error) {
                console.error('Error starting chat:', error);
                alert('Failed to start chat. Please try again.');
            }
        });

        // Load chat messages
        async function loadChatMessages(chatId) {
            try {
                const response = await fetch(`/api/chat/${chatId}`);
                if (!response.ok) throw new Error('Failed to load messages');
                
                const chat = await response.json();
                const messagesContainer = document.getElementById('chat-messages');
                messagesContainer.innerHTML = '';

                chat.messages.forEach(msg => {
                    addMessageToChat(msg);
                });

                setTimeout(() => {
                    enforceChatHeight();
                    scrollToBottom();
                }, 100);
            } catch (error) {
                console.error('Error loading messages:', error);
            }
        }

        // Force chat messages container to respect height constraints (not needed with fullscreen)
        function enforceChatHeight() {
            // Function kept for compatibility but no longer needed with fullscreen layout
            // The flexbox layout handles height automatically
        }
        
        // Add message to chat UI
        function addMessageToChat(message) {
            const messagesContainer = document.getElementById('chat-messages');
            if (!messagesContainer) return;
            
            const isClient = message.senderType === 'client';
            
            const messageDiv = document.createElement('div');
            messageDiv.className = `flex ${isClient ? 'justify-end' : 'justify-start'} mb-3`;
            messageDiv.style.cssText = 'width: 100%; max-width: 100%; min-width: 0; box-sizing: border-box;';
            messageDiv.setAttribute('data-message-id', message.id || Date.now().toString());
            
            // Escape HTML to prevent XSS and ensure proper text wrapping
            const safeText = message.text ? message.text.replace(/</g, '&lt;').replace(/>/g, '&gt;') : '';
            const safeName = message.senderName ? message.senderName.replace(/</g, '&lt;').replace(/>/g, '&gt;') : '';
            
            // Use CSS percentage-based max-width instead of pixel calculation
            // The CSS rule #chat-messages > div > div already handles max-width: 85%
            // This ensures messages adapt to container width regardless of screen size
            messageDiv.innerHTML = `
                <div class="${isClient ? 'bg-primary text-white' : 'bg-surface text-text-primary'} rounded-lg p-3" style="max-width: 75% !important; width: fit-content !important; min-width: 0 !important; word-wrap: break-word !important; overflow-wrap: break-word !important; hyphens: auto; box-sizing: border-box !important; overflow: visible !important; display: inline-block !important;">
                    <div class="${isClient ? 'text-xs' : 'text-sm'} font-semibold mb-1" style="word-wrap: break-word !important; overflow-wrap: break-word !important; overflow: visible !important; max-width: 100% !important;">${safeName}</div>
                    ${safeText ? `<div class="${isClient ? 'text-sm' : 'text-base'} mb-2" style="word-wrap: break-word !important; overflow-wrap: break-word !important; white-space: pre-wrap !important; overflow: visible !important; max-width: 100% !important; word-break: break-word !important;">${safeText}</div>` : ''}
                    <div class="text-xs opacity-75 mt-1">${new Date(message.timestamp).toLocaleTimeString()}</div>
                </div>
            `;
            
            messagesContainer.appendChild(messageDiv);
            
            // Enforce height constraints after adding message
            setTimeout(() => {
                enforceChatHeight();
                scrollToBottom();
            }, 10);
        }

        // Send message
        document.getElementById('chat-send-btn')?.addEventListener('click', sendMessage);
        document.getElementById('chat-message-input')?.addEventListener('keypress', (e) => {
            if (e.key === 'Enter') sendMessage();
        });

        async function sendMessage() {
            const input = document.getElementById('chat-message-input');
            const text = input.value.trim();

            if (!text) {
                return;
            }

            if (!currentChatId) {
                alert('Please start a chat first');
                return;
            }

            try {
                const response = await fetch(`/api/chat/${currentChatId}/message`, {
                    method: 'POST',
                    headers: { 'Content-Type': 'application/json' },
                    body: JSON.stringify({
                        text,
                        senderType: 'client',
                        senderName: document.getElementById('client-name').value
                    })
                });

                if (!response.ok) throw new Error('Failed to send message');

                input.value = '';
            } catch (error) {
                console.error('Error sending message:', error);
                alert('Failed to send message. Please try again.');
            }
        }


        function scrollToBottom() {
            const messagesContainer = document.getElementById('chat-messages');
            if (messagesContainer) {
                // Use setTimeout to ensure DOM is updated before scrolling
                setTimeout(() => {
                    messagesContainer.scrollTop = messagesContainer.scrollHeight;
                }, 100);
            }
        }

        // Add resize listener to enforce height when window resizes
        let resizeTimeout;
        window.addEventListener('resize', () => {
            clearTimeout(resizeTimeout);
            resizeTimeout = setTimeout(() => {
                enforceChatHeight();
            }, 150);
        });

        // Use ResizeObserver to watch for chat widget size changes
        if (typeof ResizeObserver !== 'undefined') {
            const chatWidgetObserver = new ResizeObserver(() => {
                enforceChatHeight();
            });
            
            // Observe chat widget when it becomes visible
            const observeChatWidget = () => {
                const chatWidget = document.getElementById('chat-widget-container');
                if (chatWidget && !chatWidget.classList.contains('hidden')) {
                    chatWidgetObserver.observe(chatWidget);
                }
            };
            
            // Start observing when DOM is ready
            if (document.readyState === 'loading') {
                document.addEventListener('DOMContentLoaded', observeChatWidget);
            } else {
                observeChatWidget();
            }
        }

        // Check if user is logged in and hide navigation for clients
        async function checkUserAndHideNav() {
            try {
                const response = await fetch('/api/auth/me', { credentials: 'include' });
                if (response.ok) {
                    const data = await response.json();
                    if (data.user && data.user.role !== 'admin') {
                        // User is a client - hide navigation
                        const nav = document.querySelector('nav.hidden.md\\:flex');
                        if (nav) nav.style.display = 'none';
                        
                        // Hide "Create Shipment" links
                        document.querySelectorAll('a[href*="shipment_creation_portal"]').forEach(link => {
                            link.style.display = 'none';
                        });
                        
                        // Update logo to not redirect
                        const logoLink = document.querySelector('a[href="homepage.html"]');
                        if (logoLink) {
                            logoLink.href = '#';
                            logoLink.style.cursor = 'default';
                        }
                        
                        // Add user profile to header
                        const headerRight = document.querySelector('.hidden.lg\\:flex.items-center.space-x-4');
                        if (headerRight) {
                            // Get display name
                            let displayName = '';
                            if (data.user.firstName && data.user.lastName) {
                                displayName = `${data.user.firstName} ${data.user.lastName}`;
                            } else if (data.user.firstName) {
                                displayName = data.user.firstName;
                            } else if (data.user.lastName) {
                                displayName = data.user.lastName;
                            } else {
                                displayName = data.user.username || 'User';
                            }
                            
                            // Get initials
                            let initials = 'U';
                            if (data.user.firstName || data.user.lastName) {
                                const first = data.user.firstName ? data.user.firstName.charAt(0).toUpperCase() : '';
                                const last = data.user.lastName ? data.user.lastName.charAt(0).toUpperCase() : '';
                                initials = first + last || displayName.charAt(0).toUpperCase();
                            } else {
                                initials = displayName.substring(0, 2).toUpperCase();
                            }
                            
                            headerRight.innerHTML = `
                                <div class="flex items-center gap-3">
                                    <div style="width: 32px; height: 32px; border-radius: 50%; background: linear-gradient(135deg, #667eea 0%, #764ba2 100%); display: flex; align-items: center; justify-content: center; color: white; font-weight: 600; font-size: 14px;">
                                        ${initials}
                                    </div>
                                    <span class="text-sm font-medium text-text-primary">${displayName}</span>
                                    <button onclick="logout()" class="text-sm text-text-secondary hover:text-primary">Logout</button>
                                </div>
                            `;
                        }
                    }
                }
            } catch (error) {
                console.log('Not logged in or error checking auth');
            }
        }
        
        // Logout function
        async function logout() {
            try {
                await fetch('/api/auth/logout', { method: 'POST', credentials: 'include' });
                window.location.href = '/pages/homepage.html';
            } catch (error) {
                console.error('Logout error:', error);
                window.location.href = '/pages/homepage.html';
            }
        }

        // Initialize socket on page load
        document.addEventListener('DOMContentLoaded', () => {
            // Check user and hide navigation if client
            checkUserAndHideNav();
            // Socket will be initialized when chat is opened
        });
    </script>
<script id="dhws-dataInjector" src="../public/dhws-data-injector.js"></script>
</body>
</html>