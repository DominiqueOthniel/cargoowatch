<!DOCTYPE html>
<html lang="en">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>Create Shipment - CargoWatch</title>
    <!-- Langue par d√©faut : anglais -->
    <script>
        (function() {
            const supportedLanguages = ['en', 'fr', 'es', 'de', 'pt', 'it', 'zh', 'ja', 'ru', 'ar'];
            let detectedLang = 'en'; // Par d√©faut : anglais
            
            // V√©rifier si une pr√©f√©rence est sauvegard√©e
            try {
                const savedLang = localStorage.getItem('cargowatch_lang');
                if (savedLang && supportedLanguages.includes(savedLang)) {
                    detectedLang = savedLang;
                }
            } catch(e) {}
            
            document.documentElement.setAttribute('lang', detectedLang);
        })();
    </script>
    <link rel="stylesheet" href="../css/main.css">
    <link rel="preconnect" href="https://fonts.googleapis.com">
    <link rel="preconnect" href="https://fonts.gstatic.com" crossorigin>
    <script src="/public/i18n.js"></script>
    <script src="/public/init-i18n.js"></script>
  
  <!-- Scripts Rocket d√©sactiv√©s temporairement pour √©viter les boucles de redirection -->
  <!-- <script type="module" src="https://static.rocket.new/rocket-web.js?_cfg=https%3A%2F%2Fcargowatch6877back.builtwithrocket.new&_be=https%3A%2F%2Fapplication.rocket.new&_v=0.1.9"></script> -->
  <!-- <script type="module" src="https://static.rocket.new/rocket-shot.js?v=0.0.1"></script> -->
  </head>
<body class="bg-background">
    <!-- Smart Header with Navigation -->
    <header class="bg-white border-b border-border sticky top-0 z-50 shadow-soft">
        <div class="max-w-7xl mx-auto px-4 sm:px-6 lg:px-8">
            <div class="flex items-center justify-between h-16">
                <!-- Logo -->
                <div class="flex items-center">
                    <a href="homepage.html" class="flex items-center space-x-2">
                        <img src="/delivery-truck-logo.png" alt="CargoWatch Logo" class="w-8 h-8 object-contain">
                        <span class="text-xl font-bold text-primary">CargoWatch</span>
                    </a>
                </div>

                <!-- Navigation -->
                <nav class="hidden md:flex items-center space-x-8">
                    <a href="homepage.html" class="text-text-secondary hover:text-primary transition-colors">Home</a>
                    <a href="public_tracking_interface.html" class="text-text-secondary hover:text-primary transition-colors">Track Shipment</a>
                    <a href="shipment_creation_portal.html" class="text-primary font-semibold">Create Shipment</a>
                    <a href="support_hub.html" class="text-text-secondary hover:text-primary transition-colors">Support</a>
                </nav>

                <!-- Tracking Search Bar -->
                <div class="hidden lg:flex items-center space-x-4">
                    <div class="relative">
                        <input type="text" placeholder="Enter tracking ID..." class="input-field w-64 pl-10 pr-4 py-2">
                        <svg class="w-5 h-5 text-text-muted absolute left-3 top-1/2 transform -translate-y-1/2" fill="none" stroke="currentColor" viewBox="0 0 24 24">
                            <path stroke-linecap="round" stroke-linejoin="round" stroke-width="2" d="M21 21l-6-6m2-5a7 7 0 11-14 0 7 7 0 0114 0z"/>
                        </svg>
                    </div>
                    <a href="admin_dashboard.html" class="btn-primary hidden">Admin Login</a>
                </div>

                <!-- Mobile Menu Button -->
                <button class="md:hidden p-2 rounded-md text-text-secondary hover:text-primary">
                    <svg class="w-6 h-6" fill="none" stroke="currentColor" viewBox="0 0 24 24">
                        <path stroke-linecap="round" stroke-linejoin="round" stroke-width="2" d="M4 6h16M4 12h16M4 18h16"/>
                    </svg>
                </button>
            </div>
        </div>
    </header>

    <!-- Hero Section -->
    <section class="bg-gradient-to-br from-primary-50 to-secondary-50 py-12">
        <div class="max-w-7xl mx-auto px-4 sm:px-6 lg:px-8">
            <div class="text-center">
                <h1 class="text-4xl lg:text-5xl font-bold text-text-primary mb-4">
                    Create Your <span class="text-gradient-primary">Shipment</span>
                </h1>
                <p class="text-xl text-text-secondary max-w-3xl mx-auto mb-8">
                    Cr√©ation professionnelle d'exp√©ditions au Cameroun. Exp√©diez dans tout le Cameroun avec des identifiants de suivi instantan√©s, des estimations de co√ªts en temps r√©el et une visibilit√© compl√®te du ramassage √† la livraison.
                </p>
                
                <!-- Quick Stats -->
                <div class="grid grid-cols-4 gap-4 max-w-3xl mx-auto">
                    <div class="text-center">
                        <div class="text-2xl font-bold text-primary">< 2 min</div>
                        <div class="text-sm text-text-muted">Average Creation Time</div>
                    </div>
                    <div class="text-center">
                        <div class="text-2xl font-bold text-success">99.9%</div>
                        <div class="text-sm text-text-muted">Delivery Success Rate</div>
                    </div>
                    <div class="text-center">
                        <div class="text-2xl font-bold text-accent">24/7</div>
                        <div class="text-sm text-text-muted">Live Tracking</div>
                    </div>
                    <div class="text-center">
                        <div class="text-2xl font-bold text-primary">üåç</div>
                        <div class="text-sm text-text-muted">Worldwide Delivery</div>
                    </div>
                </div>
            </div>
        </div>
    </section>

    <!-- Main Content -->
    <section class="py-12">
        <div class="max-w-7xl mx-auto px-4 sm:px-6 lg:px-8">
            <div class="grid lg:grid-cols-3 gap-8">
                <!-- Shipment Creation Form -->
                <div class="lg:col-span-2">
                    <div class="card">
                        <!-- Progress Indicator -->
                        <div class="mb-8">
                            <div class="flex items-center justify-between mb-4">
                                <h2 class="text-2xl font-bold text-text-primary">D√©tails de l'Exp√©dition</h2>
                                <span class="text-sm text-text-muted">Formulaire de cr√©ation</span>
                            </div>
                            <!-- Progress bar simplifi√©e -->
                            <div class="w-full bg-border rounded-full h-2">
                                <div class="bg-primary h-2 rounded-full" style="width: 100%"></div>
                            </div>
                            <p class="text-sm text-text-muted mt-2">Remplissez le formulaire ci-dessous pour cr√©er une nouvelle exp√©dition</p>
                        </div>

                        <form id="shipment-form" class="space-y-8">
                            <!-- Sender Information -->
                            <div>
                                <h3 class="text-lg font-semibold text-text-primary mb-4 flex items-center">
                                    <svg class="w-5 h-5 text-primary mr-2" fill="none" stroke="currentColor" viewBox="0 0 24 24">
                                        <path stroke-linecap="round" stroke-linejoin="round" stroke-width="2" d="M16 7a4 4 0 11-8 0 4 4 0 018 0zM12 14a7 7 0 00-7 7h14a7 7 0 00-7-7z"/>
                                    </svg>
                                    Informations de l'Exp√©diteur
                                </h3>
                                <div class="grid md:grid-cols-2 gap-4">
                                    <div>
                                        <label class="block text-sm font-medium text-text-primary mb-2">Nom Complet *</label>
                                        <input type="text" name="sender-name" class="input-field" placeholder="Jean Dupont" required>
                                    </div>
                                    <div>
                                        <label class="block text-sm font-medium text-text-primary mb-2">Entreprise (Optionnel)</label>
                                        <input type="text" name="sender-company" class="input-field" placeholder="Nom de l'entreprise">
                                    </div>
                                    <div>
                                        <label class="block text-sm font-medium text-text-primary mb-2">Adresse Email *</label>
                                        <input type="email" name="sender-email" class="input-field" placeholder="jean@example.com" required>
                                    </div>
                                    <div>
                                        <label class="block text-sm font-medium text-text-primary mb-2">Num√©ro de T√©l√©phone *</label>
                                        <input type="tel" name="sender-phone" class="input-field" placeholder="+237 6XX XXX XXX" required>
                                    </div>
                                </div>
                            </div>

                            <!-- Sender Address -->
                            <div>
                                <h4 class="text-md font-medium text-text-primary mb-3">Adresse de Ramassage</h4>
                                <div class="space-y-4">
                                    <div>
                                        <label class="block text-sm font-medium text-text-primary mb-2">Adresse Compl√®te *</label>
                                        <input type="text" name="sender-street" class="input-field" placeholder="Rue, Quartier, Arrondissement" required>
                                        <div class="mt-1 text-xs text-text-muted">Exemple: Rue 1234, Quartier Bastos, Yaound√©</div>
                                    </div>
                                    <div class="grid md:grid-cols-2 gap-4 mb-4">
                                        <div>
                                            <label class="block text-sm font-medium text-text-primary mb-2">R√©gion *</label>
                                            <select name="sender-region" id="sender-region" class="input-field" required>
                                                <option value="">S√©lectionner une r√©gion</option>
                                                <option value="Adamaoua">Adamaoua</option>
                                                <option value="Centre">Centre</option>
                                                <option value="Est">Est</option>
                                                <option value="Extr√™me-Nord">Extr√™me-Nord</option>
                                                <option value="Littoral">Littoral</option>
                                                <option value="Nord">Nord</option>
                                                <option value="Nord-Ouest">Nord-Ouest</option>
                                                <option value="Ouest">Ouest</option>
                                                <option value="Sud">Sud</option>
                                                <option value="Sud-Ouest">Sud-Ouest</option>
                                            </select>
                                        </div>
                                        <div>
                                            <label class="block text-sm font-medium text-text-primary mb-2">Ville *</label>
                                            <select name="sender-city" id="sender-city" class="input-field" required>
                                                <option value="">S√©lectionner une ville</option>
                                            </select>
                                        </div>
                                    </div>
                                    <div class="grid md:grid-cols-2 gap-4 mb-4">
                                        <div>
                                            <label class="block text-sm font-medium text-text-primary mb-2">Code Postal (Optionnel)</label>
                                            <input type="text" name="sender-zip" class="input-field" placeholder="00000">
                                        </div>
                                        <div>
                                            <label class="block text-sm font-medium text-text-primary mb-2">Pays *</label>
                                            <select name="sender-country" class="input-field" required>
                                                <option value="CM" selected>Cameroon / Cameroun</option>
                                            </select>
                                        </div>
                                    </div>
                                </div>
                            </div>

                            <!-- Recipient Information -->
                            <div>
                                <h3 class="text-lg font-semibold text-text-primary mb-4 flex items-center">
                                    <svg class="w-5 h-5 text-accent mr-2" fill="none" stroke="currentColor" viewBox="0 0 24 24">
                                        <path stroke-linecap="round" stroke-linejoin="round" stroke-width="2" d="M17.657 16.657L13.414 20.9a1.998 1.998 0 01-2.827 0l-4.244-4.243a8 8 0 1111.314 0z"/>
                                        <path stroke-linecap="round" stroke-linejoin="round" stroke-width="2" d="M15 11a3 3 0 11-6 0 3 3 0 016 0z"/>
                                    </svg>
                                    Informations du Destinataire
                                </h3>
                                <div class="grid md:grid-cols-2 gap-4">
                                    <div>
                                        <label class="block text-sm font-medium text-text-primary mb-2">Nom Complet *</label>
                                        <input type="text" name="recipient-name" class="input-field" placeholder="Marie Martin" required>
                                    </div>
                                    <div>
                                        <label class="block text-sm font-medium text-text-primary mb-2">Entreprise (Optionnel)</label>
                                        <input type="text" name="recipient-company" class="input-field" placeholder="Nom de l'entreprise">
                                    </div>
                                    <div>
                                        <label class="block text-sm font-medium text-text-primary mb-2">Adresse Email *</label>
                                        <input type="email" name="recipient-email" class="input-field" placeholder="marie@example.com" required>
                                    </div>
                                    <div>
                                        <label class="block text-sm font-medium text-text-primary mb-2">Num√©ro de T√©l√©phone *</label>
                                        <input type="tel" name="recipient-phone" class="input-field" placeholder="+237 6XX XXX XXX" required>
                                    </div>
                                </div>
                            </div>

                            <!-- Delivery Address -->
                            <div>
                                <h4 class="text-md font-medium text-text-primary mb-3">Adresse de Livraison</h4>
                                <div class="space-y-4">
                                    <div>
                                        <label class="block text-sm font-medium text-text-primary mb-2">Adresse Compl√®te *</label>
                                        <input type="text" name="recipient-street" class="input-field" placeholder="Rue, Quartier, Arrondissement" required>
                                    </div>
                                    <div class="grid md:grid-cols-2 gap-4 mb-4">
                                        <div>
                                            <label class="block text-sm font-medium text-text-primary mb-2">R√©gion *</label>
                                            <select name="recipient-region" id="recipient-region" class="input-field" required>
                                                <option value="">S√©lectionner une r√©gion</option>
                                                <option value="Adamaoua">Adamaoua</option>
                                                <option value="Centre">Centre</option>
                                                <option value="Est">Est</option>
                                                <option value="Extr√™me-Nord">Extr√™me-Nord</option>
                                                <option value="Littoral">Littoral</option>
                                                <option value="Nord">Nord</option>
                                                <option value="Nord-Ouest">Nord-Ouest</option>
                                                <option value="Ouest">Ouest</option>
                                                <option value="Sud">Sud</option>
                                                <option value="Sud-Ouest">Sud-Ouest</option>
                                            </select>
                                        </div>
                                        <div>
                                            <label class="block text-sm font-medium text-text-primary mb-2">Ville *</label>
                                            <select name="recipient-city" id="recipient-city" class="input-field" required>
                                                <option value="">S√©lectionner une ville</option>
                                            </select>
                                        </div>
                                    </div>
                                    <div class="grid md:grid-cols-2 gap-4 mb-4">
                                        <div>
                                            <label class="block text-sm font-medium text-text-primary mb-2">Code Postal (Optionnel)</label>
                                            <input type="text" name="recipient-zip" class="input-field" placeholder="00000">
                                        </div>
                                        <div>
                                            <label class="block text-sm font-medium text-text-primary mb-2">Pays *</label>
                                            <select name="recipient-country" class="input-field" required>
                                                <option value="CM" selected>Cameroon / Cameroun</option>
                                            </select>
                                        </div>
                                    </div>
                                </div>
                            </div>

                            <!-- Package Information -->
                            <div>
                                <h3 class="text-lg font-semibold text-text-primary mb-4 flex items-center">
                                    <svg class="w-5 h-5 text-success mr-2" fill="none" stroke="currentColor" viewBox="0 0 24 24">
                                        <path stroke-linecap="round" stroke-linejoin="round" stroke-width="2" d="M20 7l-8-4-8 4m16 0l-8 4m8-4v10l-8 4m0-10L4 7m8 4v10M4 7v10l8 4"/>
                                    </svg>
                                    D√©tails du Colis
                                </h3>
                                <div class="space-y-4">
                                    <div class="grid md:grid-cols-2 gap-4">
                                        <div>
                                            <label class="block text-sm font-medium text-text-primary mb-2">Type d'article *</label>
                                            <select id="package-type" name="package-type" class="input-field" required onchange="handlePackageTypeChange()">
                                                <option value="">S√©lectionner un type</option>
                                                <optgroup label="Documents & Petits Articles">
                                                <option value="envelope">Enveloppe/Document</option>
                                                <option value="small-box">Petite Bo√Æte</option>
                                                <option value="medium-box">Bo√Æte Moyenne</option>
                                                <option value="large-box">Grande Bo√Æte</option>
                                                </optgroup>
                                                <optgroup label="V√©hicules">
                                                    <option value="car">Voiture / Berline</option>
                                                    <option value="suv">SUV / Crossover</option>
                                                    <option value="truck">Camion / Pickup</option>
                                                    <option value="van">Fourgon / Minibus</option>
                                                    <option value="motorcycle">Moto</option>
                                                    <option value="rv">Camping-car</option>
                                                    <option value="boat">Bateau / Embarcation</option>
                                                    <option value="atv">Quad / V√©hicule Tout-Terrain</option>
                                                </optgroup>
                                                <optgroup label="√âquipement Lourd">
                                                    <option value="construction">√âquipement de Construction</option>
                                                    <option value="agricultural">Machinerie Agricole</option>
                                                    <option value="industrial">Machinerie Industrielle</option>
                                                    <option value="tractor">Tracteur</option>
                                                    <option value="trailer">Remorque</option>
                                                </optgroup>
                                                <optgroup label="Articles Volumineux">
                                                    <option value="furniture">Meubles</option>
                                                    <option value="appliance">Gros √âlectrom√©nager</option>
                                                    <option value="piano">Piano / Instrument de Musique</option>
                                                    <option value="container">Conteneur</option>
                                                    <option value="custom">Personnalis√© / Autre</option>
                                                </optgroup>
                                            </select>
                                        </div>
                                        <div>
                                            <label class="block text-sm font-medium text-text-primary mb-2">Poids (kg) *</label>
                                            <input type="number" name="weight" id="weight-input" class="input-field" placeholder="2.5" step="0.1" min="0.1" required>
                                        </div>
                                    </div>
                                    
                                    <!-- Vehicle-Specific Fields (Hidden by default) -->
                                    <div id="vehicle-fields" class="hidden space-y-4 mt-4 p-4 bg-surface rounded-lg">
                                        <h4 class="text-sm font-semibold text-text-primary mb-3">Informations du V√©hicule</h4>
                                        <div class="grid md:grid-cols-3 gap-4">
                                            <div>
                                                <label class="block text-sm font-medium text-text-primary mb-2">Marque</label>
                                                <input type="text" name="vehicle-make" id="vehicle-make" class="input-field" placeholder="Toyota">
                                            </div>
                                            <div>
                                                <label class="block text-sm font-medium text-text-primary mb-2">Mod√®le</label>
                                                <input type="text" name="vehicle-model" id="vehicle-model" class="input-field" placeholder="Camry">
                                            </div>
                                            <div>
                                                <label class="block text-sm font-medium text-text-primary mb-2">Ann√©e</label>
                                                <input type="number" name="vehicle-year" id="vehicle-year" class="input-field" placeholder="2020" min="1900" max="2030">
                                            </div>
                                        </div>
                                        <div class="grid md:grid-cols-2 gap-4">
                                            <div>
                                                <label class="block text-sm font-medium text-text-primary mb-2">N¬∞ de Ch√¢ssis (Optionnel)</label>
                                                <input type="text" name="vehicle-vin" id="vehicle-vin" class="input-field" placeholder="Num√©ro de ch√¢ssis" maxlength="17">
                                            </div>
                                            <div>
                                                <label class="block text-sm font-medium text-text-primary mb-2">√âtat de Fonctionnement</label>
                                                <select name="vehicle-condition" id="vehicle-condition" class="input-field">
                                                    <option value="running">Fonctionnel</option>
                                                    <option value="non-running">Non Fonctionnel</option>
                                                    <option value="inoperable">Inutilisable</option>
                                                </select>
                                            </div>
                                        </div>
                                    </div>
                                    
                                    <!-- Dimensions Calculator -->
                                    <div class="bg-surface p-4 rounded-lg">
                                        <h4 class="text-sm font-medium text-text-primary mb-3">Dimensions (en centim√®tres)</h4>
                                        <div class="grid grid-cols-3 gap-4">
                                            <div>
                                                <label class="block text-xs font-medium text-text-secondary mb-1">Longueur (cm)</label>
                                                <input type="number" name="length" id="length-input" class="input-field text-sm" placeholder="30" step="0.1" min="0.1">
                                            </div>
                                            <div>
                                                <label class="block text-xs font-medium text-text-secondary mb-1">Largeur (cm)</label>
                                                <input type="number" name="width" id="width-input" class="input-field text-sm" placeholder="20" step="0.1" min="0.1">
                                            </div>
                                            <div>
                                                <label class="block text-xs font-medium text-text-secondary mb-1">Hauteur (cm)</label>
                                                <input type="number" name="height" id="height-input" class="input-field text-sm" placeholder="15" step="0.1" min="0.1">
                                            </div>
                                        </div>
                                        <div class="mt-2 text-xs text-text-muted">
                                            <span id="dim-weight-label">Poids dimensionnel:</span> <span class="font-medium" id="dim-weight">Calcul en cours...</span>
                                        </div>
                                        <div id="auto-dimensions-help" class="hidden mt-2 text-xs text-accent">
                                            <svg class="w-4 h-4 inline mr-1" fill="none" stroke="currentColor" viewBox="0 0 24 24">
                                                <path stroke-linecap="round" stroke-linejoin="round" stroke-width="2" d="M13 16h-1v-4h-1m1-4h.01M21 12a9 9 0 11-18 0 9 9 0 0118 0z"/>
                                            </svg>
                                            Les dimensions standard du v√©hicule seront pr√©-remplies. Modifiez si n√©cessaire.
                                        </div>
                                    </div>

                                    <div>
                                        <label class="block text-sm font-medium text-text-primary mb-2">Description de l'article *</label>
                                        <textarea name="description" id="description-input" class="input-field" rows="3" placeholder="√âlectronique, articles fragiles, documents, v√©hicules, etc." required></textarea>
                                        <div class="mt-1 text-xs text-text-muted">D√©crivez le contenu pour une manipulation appropri√©e</div>
                                    </div>

                                    <div class="grid md:grid-cols-2 gap-4">
                                    <div>
                                            <label class="block text-sm font-medium text-text-primary mb-2">Devise *</label>
                                            <select name="currency" id="currency-select" class="input-field" required>
                                                <option value="XAF" selected>XAF - Franc CFA d'Afrique Centrale (Fr)</option>
                                                <option value="EUR">EUR - Euro (‚Ç¨)</option>
                                                <option value="USD">USD - US Dollar ($)</option>
                                                <option value="GBP">GBP - British Pound (¬£)</option>
                                                <option value="XOF">XOF - Franc CFA d'Afrique de l'Ouest (Fr)</option>
                                                <option value="CAD">CAD - Canadian Dollar ($)</option>
                                                <option value="AUD">AUD - Australian Dollar ($)</option>
                                                <option value="CHF">CHF - Swiss Franc (Fr)</option>
                                                <option value="INR">INR - Indian Rupee (‚Çπ)</option>
                                                <option value="BRL">BRL - Brazilian Real (R$)</option>
                                                <option value="MXN">MXN - Mexican Peso ($)</option>
                                                <option value="RUB">RUB - Russian Ruble (‚ÇΩ)</option>
                                                <option value="ZAR">ZAR - South African Rand (R)</option>
                                                <option value="SGD">SGD - Singapore Dollar ($)</option>
                                                <option value="HKD">HKD - Hong Kong Dollar ($)</option>
                                                <option value="NZD">NZD - New Zealand Dollar ($)</option>
                                                <option value="SEK">SEK - Swedish Krona (kr)</option>
                                                <option value="NOK">NOK - Norwegian Krone (kr)</option>
                                                <option value="DKK">DKK - Danish Krone (kr)</option>
                                                <option value="PLN">PLN - Polish Z≈Çoty (z≈Ç)</option>
                                                <option value="TRY">TRY - Turkish Lira (‚Ç∫)</option>
                                                <option value="THB">THB - Thai Baht (‡∏ø)</option>
                                                <option value="MYR">MYR - Malaysian Ringgit (RM)</option>
                                                <option value="IDR">IDR - Indonesian Rupiah (Rp)</option>
                                                <option value="PHP">PHP - Philippine Peso (‚Ç±)</option>
                                                <option value="VND">VND - Vietnamese Dong (‚Ç´)</option>
                                                <option value="KRW">KRW - South Korean Won (‚Ç©)</option>
                                                <option value="TWD">TWD - New Taiwan Dollar (NT$)</option>
                                                <option value="AED">AED - UAE Dirham (ÿØ.ÿ•)</option>
                                                <option value="SAR">SAR - Saudi Riyal (Ô∑º)</option>
                                                <option value="ILS">ILS - Israeli Shekel (‚Ç™)</option>
                                                <option value="EGP">EGP - Egyptian Pound (¬£)</option>
                                                <option value="NGN">NGN - Nigerian Naira (‚Ç¶)</option>
                                                <option value="KES">KES - Kenyan Shilling (KSh)</option>
                                                <option value="ARS">ARS - Argentine Peso ($)</option>
                                                <option value="CLP">CLP - Chilean Peso ($)</option>
                                                <option value="COP">COP - Colombian Peso ($)</option>
                                                <option value="PEN">PEN - Peruvian Sol (S/.)</option>
                                                <option value="PKR">PKR - Pakistani Rupee (‚Ç®)</option>
                                                <option value="BDT">BDT - Bangladeshi Taka (‡ß≥)</option>
                                                <option value="LKR">LKR - Sri Lankan Rupee (Rs)</option>
                                            </select>
                                        </div>
                                        <div>
                                            <label class="block text-sm font-medium text-text-primary mb-2">Valeur D√©clar√©e *</label>
                                            <input type="number" name="value" id="value-input" class="input-field" placeholder="100000" step="1000" min="0" required>
                                        <div class="mt-1 text-xs text-text-muted">Pour les fins d'assurance. Couverture maximale disponible. Requis pour les v√©hicules et articles de grande valeur.</div>
                                        </div>
                                    </div>
                                </div>
                            </div>

                            <!-- File Upload Section -->
                            <div>
                                <h3 class="text-lg font-semibold text-text-primary mb-4 flex items-center">
                                    <svg class="w-5 h-5 text-accent mr-2" fill="none" stroke="currentColor" viewBox="0 0 24 24">
                                        <path stroke-linecap="round" stroke-linejoin="round" stroke-width="2" d="M7 16a4 4 0 01-.88-7.903A5 5 0 1115.9 6L16 6a5 5 0 011 9.9M15 13l-3-3m0 0l-3 3m3-3v12"/>
                                    </svg>
                                    Pi√®ces Jointes (Optionnel)
                                </h3>
                                <div class="border-2 border-dashed border-border rounded-lg p-6 text-center">
                                    <svg class="w-12 h-12 text-text-muted mx-auto mb-4" fill="none" stroke="currentColor" viewBox="0 0 24 24">
                                        <path stroke-linecap="round" stroke-linejoin="round" stroke-width="2" d="M7 16a4 4 0 01-.88-7.903A5 5 0 1115.9 6L16 6a5 5 0 011 9.9M15 13l-3-3m0 0l-3 3m3-3v12"/>
                                    </svg>
                                    <p class="text-text-secondary mb-2">Glissez les fichiers ici ou cliquez pour t√©l√©charger</p>
                                    <p class="text-sm text-text-muted">Support pour images, PDF et documents (Max 10MB chacun)</p>
                                    <input type="file" class="hidden" id="file-upload" multiple accept=".jpg,.jpeg,.png,.pdf,.doc,.docx">
                                    <button type="button" class="btn-secondary mt-4" onclick="document.getElementById('file-upload').click()">
                                        Choisir des Fichiers
                                    </button>
                                </div>
                            </div>

                            <!-- Form Actions -->
                            <div class="flex flex-col sm:flex-row gap-4 pt-6 border-t border-border">
                                <button type="button" id="create-shipment-btn" class="btn-primary flex-1" onclick="nextStep()">
                                    <svg class="w-5 h-5 mr-2" fill="none" stroke="currentColor" viewBox="0 0 24 24">
                                        <path stroke-linecap="round" stroke-linejoin="round" stroke-width="2" d="M12 4v16m8-8H4"/>
                                    </svg>
                                    Cr√©er l'Exp√©dition
                                </button>
                                <button type="button" class="btn-secondary" onclick="saveDraft()">
                                    Enregistrer comme Brouillon
                                </button>
                            </div>
                        </form>
                    </div>
                </div>

                <!-- Sidebar -->
                <div class="space-y-6">
                    <!-- Shipping Cost Input -->
                    <div class="card">
                        <h3 class="text-lg font-semibold text-text-primary mb-4 flex items-center">
                            <svg class="w-5 h-5 text-primary mr-2" fill="none" stroke="currentColor" viewBox="0 0 24 24">
                                <path stroke-linecap="round" stroke-linejoin="round" stroke-width="2" d="M12 8c-1.657 0-3 .895-3 2s1.343 2 3 2 3 .895 3 2-1.343 2-3 2m0-8c1.11 0 2.08.402 2.599 1M12 8V7m0 1v8m0 0v1m0-1c-1.11 0-2.08-.402-2.599-1"/>
                            </svg>
                            Co√ªts d'Exp√©dition *
                        </h3>
                        <div class="space-y-4">
                            <div>
                                <label class="block text-sm font-medium text-text-primary mb-2">Co√ªt de Base</label>
                                <div class="flex gap-2">
                                    <select id="cost-currency" name="cost-currency" class="input-field w-24 flex-shrink-0" required>
                                        <option value="XAF" selected>XAF (Fr)</option>
                                        <option value="EUR">EUR (‚Ç¨)</option>
                                        <option value="USD">USD ($)</option>
                                        <option value="GBP">GBP (¬£)</option>
                                        <option value="XOF">XOF (Fr)</option>
                                        <option value="CAD">CAD ($)</option>
                                        <option value="AUD">AUD ($)</option>
                                        <option value="CHF">CHF (Fr)</option>
                                        <option value="INR">INR (‚Çπ)</option>
                                        <option value="BRL">BRL (R$)</option>
                                        <option value="MXN">MXN ($)</option>
                                        <option value="RUB">RUB (‚ÇΩ)</option>
                                        <option value="ZAR">ZAR (R)</option>
                                        <option value="SGD">SGD ($)</option>
                                        <option value="HKD">HKD ($)</option>
                                        <option value="NZD">NZD ($)</option>
                                        <option value="SEK">SEK (kr)</option>
                                        <option value="NOK">NOK (kr)</option>
                                        <option value="DKK">DKK (kr)</option>
                                        <option value="PLN">PLN (z≈Ç)</option>
                                        <option value="TRY">TRY (‚Ç∫)</option>
                                        <option value="THB">THB (‡∏ø)</option>
                                        <option value="MYR">MYR (RM)</option>
                                        <option value="IDR">IDR (Rp)</option>
                                        <option value="PHP">PHP (‚Ç±)</option>
                                        <option value="VND">VND (‚Ç´)</option>
                                        <option value="KRW">KRW (‚Ç©)</option>
                                        <option value="TWD">TWD (NT$)</option>
                                        <option value="AED">AED (ÿØ.ÿ•)</option>
                                        <option value="SAR">SAR (Ô∑º)</option>
                                        <option value="ILS">ILS (‚Ç™)</option>
                                        <option value="EGP">EGP (¬£)</option>
                                        <option value="NGN">NGN (‚Ç¶)</option>
                                        <option value="KES">KES (KSh)</option>
                                        <option value="ARS">ARS ($)</option>
                                        <option value="CLP">CLP ($)</option>
                                        <option value="COP">COP ($)</option>
                                        <option value="PEN">PEN (S/.)</option>
                                        <option value="PKR">PKR (‚Ç®)</option>
                                        <option value="BDT">BDT (‡ß≥)</option>
                                        <option value="LKR">LKR (Rs)</option>
                                    </select>
                                    <input type="number" id="cost-base" name="cost-base" class="input-field flex-1" placeholder="0" step="1000" min="0" value="0" required>
                            </div>
                            </div>
                            <div>
                                <label class="block text-sm font-medium text-text-primary mb-2">Frais d'Exp√©dition</label>
                                <input type="number" id="cost-shipping" name="cost-shipping" class="input-field" placeholder="0" step="1000" min="0" value="0" required>
                            </div>
                            <div>
                                <label class="block text-sm font-medium text-text-primary mb-2">Frais d'Assurance</label>
                                <input type="number" id="cost-insurance" name="cost-insurance" class="input-field" placeholder="0" step="1000" min="0" value="0">
                            </div>
                            <div class="border-t border-border pt-3">
                                <div class="flex justify-between items-center">
                                    <span class="text-lg font-semibold text-text-primary">Total</span>
                                    <span id="cost-total-display" class="text-lg font-bold text-primary">0 Fr</span>
                                </div>
                            </div>
                        </div>
                        <div class="mt-4 p-3 bg-info-50 rounded-lg">
                            <p class="text-sm text-info-700">
                                <svg class="w-4 h-4 inline mr-1" fill="none" stroke="currentColor" viewBox="0 0 24 24">
                                    <path stroke-linecap="round" stroke-linejoin="round" stroke-width="2" d="M13 16h-1v-4h-1m1-4h.01M21 12a9 9 0 11-18 0 9 9 0 0118 0z"/>
                                </svg>
                                Entrez les co√ªts d'exp√©dition manuellement
                            </p>
                        </div>
                    </div>

                    <!-- Delivery Time Estimator -->
                    <div class="card">
                        <h3 class="text-lg font-semibold text-text-primary mb-4 flex items-center">
                            <svg class="w-5 h-5 text-accent mr-2" fill="none" stroke="currentColor" viewBox="0 0 24 24">
                                <path stroke-linecap="round" stroke-linejoin="round" stroke-width="2" d="M12 8v4l3 3m6-3a9 9 0 11-18 0 9 9 0 0118 0z"/>
                            </svg>
                            Estimation de Livraison
                        </h3>
                        <div class="space-y-3">
                            <div class="p-3 bg-primary-50 rounded-lg border border-primary-200">
                                <div class="flex items-center justify-between">
                                    <div>
                                        <div class="font-medium text-primary">Standard</div>
                                        <div class="text-sm text-text-muted">3-7 jours ouvrables</div>
                                    </div>
                                    <div class="text-right">
                                        <div class="text-xs text-success">Le Plus Populaire</div>
                                    </div>
                                </div>
                            </div>
                            <div class="p-3 bg-surface rounded-lg">
                                <div class="flex items-center justify-between">
                                    <div>
                                        <div class="font-medium text-text-primary">Express</div>
                                        <div class="text-sm text-text-muted">1-3 jours ouvrables</div>
                                    </div>
                                </div>
                            </div>
                            <div class="p-3 bg-surface rounded-lg">
                                <div class="flex items-center justify-between">
                                    <div>
                                        <div class="font-medium text-text-primary">Urgent</div>
                                        <div class="text-sm text-text-muted">24-48 heures</div>
                                    </div>
                                </div>
                            </div>
                            <div class="mt-3 p-3 bg-info-50 rounded-lg">
                                <p class="text-xs text-info-700">
                                    L'estimation sera calcul√©e automatiquement selon la distance entre les villes camerounaises
                                </p>
                            </div>
                        </div>
                    </div>
                            </div>
            </div>
        </div>
    </section>

    <!-- Footer -->
    <footer class="bg-text-primary text-white py-16">
        <div class="max-w-7xl mx-auto px-4 sm:px-6 lg:px-8">
            <div class="grid md:grid-cols-4 gap-8">
                <!-- Company Info -->
                <div>
                    <div class="flex items-center space-x-2 mb-6">
                        <img src="/delivery-truck-logo.png" alt="CargoWatch Logo" class="w-8 h-8 object-contain">
                        <span class="text-xl font-bold">CargoWatch</span>
                    </div>
                    <p class="text-text-muted mb-4">Your cargo. Our watch. Every mile.</p>
                    <p class="text-sm text-text-muted">¬© 2025 CargoWatch. All Rights Reserved.</p>
                </div>

                <!-- Services -->
                <div>
                    <h4 class="font-semibold mb-4">Services</h4>
                    <ul class="space-y-2 text-sm text-text-muted">
                        <li><a href="public_tracking_interface.html" class="hover:text-white transition-colors">Package Tracking</a></li>
                        <li><a href="shipment_creation_portal.html" class="hover:text-white transition-colors">Create Shipment</a></li>
                        <li><a href="admin_dashboard.html" class="hover:text-white transition-colors hidden">Admin Dashboard</a></li>
                    </ul>
                </div>

                <!-- Support -->
                <div>
                    <h4 class="font-semibold mb-4">Support</h4>
                    <ul class="space-y-2 text-sm text-text-muted">
                        <li><a href="support_hub.html" class="hover:text-white transition-colors">Help Center</a></li>
                        <li><a href="support_hub.html" class="hover:text-white transition-colors">Contact Us</a></li>
                        <li><a href="support_hub.html" class="hover:text-white transition-colors">System Status</a></li>
                        <li><a href="support_hub.html" class="hover:text-white transition-colors">FAQ</a></li>
                    </ul>
                </div>

                <!-- Contact -->
                <div>
                    <h4 class="font-semibold mb-4">Contact</h4>
                    <ul class="space-y-2 text-sm text-text-muted">
                        <li>uncledrewlegacy@gmail.com</li>
                        <li>24/7 Customer Support</li>
                        <li>Enterprise Solutions</li>
                    </ul>
                </div>
            </div>
        </div>
    </footer>

    <script>
        // Form validation and interaction - Cr√©ation via API
        async function nextStep() {
            const form = document.getElementById('shipment-form');
            const requiredFields = form.querySelectorAll('[required]');
            let isValid = true;
            
            requiredFields.forEach(field => {
                if (!field.value.trim()) {
                    field.classList.add('border-error');
                    isValid = false;
                } else {
                    field.classList.remove('border-error');
                }
            });
            
            if (!isValid) {
                alert('Veuillez remplir tous les champs obligatoires.');
                return;
            }

            // Collecter les donn√©es du formulaire
            const formData = collectFormData();
            
            // Afficher un loader
            const submitButton = form.querySelector('button[type="button"]');
            const originalText = submitButton.textContent;
            submitButton.textContent = 'Cr√©ation en cours...';
            submitButton.disabled = true;

            try {
                console.log('üîÑ Submitting shipment data:', formData);
                console.log('üì§ Request URL: /api/shipments');
                console.log('üì§ Request method: POST');
                
                const response = await fetch('/api/shipments', {
                    method: 'POST',
                    headers: {
                        'Content-Type': 'application/json'
                    },
                    credentials: 'include',
                    body: JSON.stringify(formData)
                });

                console.log('üì• Response received. Status:', response.status, response.statusText);
                console.log('üì• Response headers:', Object.fromEntries(response.headers.entries()));

                const responseText = await response.text();
                console.log('üì• Response body (raw):', responseText);

                if (!response.ok) {
                    let errorMessage = 'Failed to create shipment';
                    try {
                        const errorData = JSON.parse(responseText);
                        errorMessage = errorData.error || errorMessage;
                        console.error('‚ùå Error from server:', errorData);
                    } catch (e) {
                        errorMessage = responseText || errorMessage;
                        console.error('‚ùå Error parsing error response:', e);
                    }
                    throw new Error(`Server returned ${response.status}: ${errorMessage}`);
                }

                let shipment;
                try {
                    shipment = JSON.parse(responseText);
                    console.log('‚úÖ Shipment created successfully:', shipment);
                    console.log('‚úÖ Tracking ID:', shipment.trackingId);
                } catch (parseError) {
                    console.error('‚ùå Error parsing success response:', parseError);
                    throw new Error('Invalid response from server');
                }
                
                // V√©rifier que le shipment a un trackingId
                if (!shipment.trackingId) {
                    throw new Error('Shipment created but no tracking ID received');
                }
                
                // Rediriger vers la page de tracking avec le tracking ID
                alert(`Exp√©dition cr√©√©e avec succ√®s!\n\nIdentifiant de suivi: ${shipment.trackingId}\n\nRedirection vers la page de suivi...`);
                window.location.href = `/pages/public_tracking_interface.html?track=${shipment.trackingId}`;
            } catch (error) {
                console.error('‚ùå Error creating shipment:', error);
                console.error('‚ùå Error details:', {
                    message: error.message,
                    stack: error.stack,
                    name: error.name
                });
                alert(`Erreur lors de la cr√©ation de l'exp√©dition: ${error.message}\n\nVeuillez v√©rifier la console du navigateur (F12) pour plus de d√©tails.`);
            } finally {
                submitButton.textContent = originalText;
                submitButton.disabled = false;
            }
        }

        // Collecter les donn√©es du formulaire
        function collectFormData() {
            return {
                sender: {
                    name: document.querySelector('input[name="sender-name"]')?.value || '',
                    email: document.querySelector('input[name="sender-email"]')?.value || '',
                    phone: document.querySelector('input[name="sender-phone"]')?.value || '',
                    address: {
                        street: document.querySelector('input[name="sender-street"]')?.value || '',
                        city: document.querySelector('select[name="sender-city"]')?.value || '',
                        state: document.querySelector('select[name="sender-region"]')?.value || '',
                        zipCode: document.querySelector('input[name="sender-zip"]')?.value || '',
                        country: document.querySelector('select[name="sender-country"]')?.value || 'CM'
                    }
                },
                recipient: {
                    name: document.querySelector('input[name="recipient-name"]')?.value || '',
                    email: document.querySelector('input[name="recipient-email"]')?.value || '',
                    phone: document.querySelector('input[name="recipient-phone"]')?.value || '',
                    address: {
                        street: document.querySelector('input[name="recipient-street"]')?.value || '',
                        city: document.querySelector('select[name="recipient-city"]')?.value || '',
                        state: document.querySelector('select[name="recipient-region"]')?.value || '',
                        zipCode: document.querySelector('input[name="recipient-zip"]')?.value || '',
                        country: document.querySelector('select[name="recipient-country"]')?.value || 'CM'
                    }
                },
                package: {
                    type: document.querySelector('#package-type')?.value || '',
                    weight: parseFloat(document.querySelector('#weight-input')?.value || '0'),
                    dimensions: {
                        length: parseFloat(document.querySelector('#length-input')?.value || '0'),
                        width: parseFloat(document.querySelector('#width-input')?.value || '0'),
                        height: parseFloat(document.querySelector('#height-input')?.value || '0')
                    },
                    description: document.querySelector('#description-input')?.value || '',
                    value: parseFloat(document.querySelector('#value-input')?.value || '0'),
                    currency: document.querySelector('#currency-select')?.value || 'USD',
                    // Vehicle-specific fields
                    vehicle: {
                        make: document.querySelector('#vehicle-make')?.value || '',
                        model: document.querySelector('#vehicle-model')?.value || '',
                        year: document.querySelector('#vehicle-year')?.value || '',
                        vin: document.querySelector('#vehicle-vin')?.value || '',
                        condition: document.querySelector('#vehicle-condition')?.value || ''
                    }
                },
                service: {
                    type: document.querySelector('select[name="service-type"]')?.value || 'standard',
                    priority: document.querySelector('select[name="priority"]')?.value || 'normal',
                    insurance: document.querySelector('input[name="insurance"]')?.checked || false
                },
                cost: {
                    base: parseFloat(document.getElementById('cost-base')?.value || '0'),
                    shipping: parseFloat(document.getElementById('cost-shipping')?.value || '0'),
                    insurance: parseFloat(document.getElementById('cost-insurance')?.value || '0'),
                    currency: document.getElementById('cost-currency')?.value || 'XAF'
                }
            };
        }
        
        function saveDraft() {
            alert('Draft saved successfully! You can continue later from your dashboard.');
        }
        
        function generateTrackingId() {
            const prefix = 'CW';
            const timestamp = Date.now().toString().slice(-6);
            const random = Math.random().toString(36).substr(2, 4).toUpperCase();
            return `${prefix}${timestamp}${random}`;
        }
        
        // Calculate total cost from manual inputs
        // Synchroniser les devises
        function syncCurrencies() {
            const packageCurrency = document.getElementById('currency-select');
            const costCurrency = document.getElementById('cost-currency');
            
            if (packageCurrency && costCurrency) {
                packageCurrency.addEventListener('change', () => {
                    costCurrency.value = packageCurrency.value;
                    updateCostTotal();
                });
                
                costCurrency.addEventListener('change', () => {
                    packageCurrency.value = costCurrency.value;
                    updateCostTotal();
                });
            }
        }
        
        // Obtenir le symbole de la devise
        function getCurrencySymbol(currencyCode) {
            const symbols = {
                'USD': '$', 'EUR': '‚Ç¨', 'GBP': '¬£', 'JPY': '¬•', 'CNY': '¬•',
                'XAF': 'Fr', 'XOF': 'Fr', 'CAD': '$', 'AUD': '$', 'CHF': 'Fr',
                'INR': '‚Çπ', 'BRL': 'R$', 'MXN': '$', 'RUB': '‚ÇΩ', 'ZAR': 'R',
                'SGD': '$', 'HKD': '$', 'NZD': '$', 'SEK': 'kr', 'NOK': 'kr',
                'DKK': 'kr', 'PLN': 'z≈Ç', 'TRY': '‚Ç∫', 'THB': '‡∏ø', 'MYR': 'RM',
                'IDR': 'Rp', 'PHP': '‚Ç±', 'VND': '‚Ç´', 'KRW': '‚Ç©', 'TWD': 'NT$',
                'AED': 'ÿØ.ÿ•', 'SAR': 'Ô∑º', 'ILS': '‚Ç™', 'EGP': '¬£', 'NGN': '‚Ç¶',
                'KES': 'KSh', 'ARS': '$', 'CLP': '$', 'COP': '$', 'PEN': 'S/.',
                'PKR': '‚Ç®', 'BDT': '‡ß≥', 'LKR': 'Rs'
            };
            return symbols[currencyCode] || currencyCode;
        }
        
        function updateCostTotal() {
            const base = parseFloat(document.getElementById('cost-base')?.value || '0');
            const shipping = parseFloat(document.getElementById('cost-shipping')?.value || '0');
            const insurance = parseFloat(document.getElementById('cost-insurance')?.value || '0');
            const total = base + shipping + insurance;
            
            const costDisplay = document.getElementById('cost-total-display');
            const costCurrency = document.getElementById('cost-currency');
            if (costDisplay && costCurrency) {
                const currency = costCurrency.value || 'XAF';
                const symbol = getCurrencySymbol(currency);
                // Format XAF without decimals (it's typically whole numbers)
                if (currency === 'XAF' || currency === 'XOF') {
                    costDisplay.textContent = `${symbol} ${Math.round(total).toLocaleString('fr-FR')}`;
                } else {
                    costDisplay.textContent = `${symbol}${total.toFixed(2)}`;
                }
            }
        }
        
        // Dimensional weight calculator (using cm, result in kg)
        function calculateDimensionalWeight() {
            const length = parseFloat(document.getElementById('length-input')?.value || '0');
            const width = parseFloat(document.getElementById('width-input')?.value || '0');
            const height = parseFloat(document.getElementById('height-input')?.value || '0');
            
            if (length > 0 && width > 0 && height > 0) {
                // Convert cm¬≥ to kg using standard divisor (5000 cm¬≥ per kg for air freight)
                const dimWeight = (length * width * height) / 5000;
                document.getElementById('dim-weight').textContent = `${dimWeight.toFixed(1)} kg`;
            } else {
                document.getElementById('dim-weight').textContent = 'Entrer les dimensions';
            }
        }
        
        // Handle package type change - Show/hide vehicle fields and auto-fill dimensions
        function handlePackageTypeChange() {
            const packageType = document.getElementById('package-type').value;
            const vehicleFields = document.getElementById('vehicle-fields');
            const autoDimensionsHelp = document.getElementById('auto-dimensions-help');
            const lengthInput = document.getElementById('length-input');
            const widthInput = document.getElementById('width-input');
            const heightInput = document.getElementById('height-input');
            const weightInput = document.getElementById('weight-input');
            
            // Vehicle types that need special handling
            const vehicleTypes = ['car', 'suv', 'truck', 'van', 'motorcycle', 'rv', 'boat', 'atv'];
            const heavyEquipmentTypes = ['construction', 'agricultural', 'industrial', 'tractor', 'trailer'];
            
            if (vehicleTypes.includes(packageType)) {
                vehicleFields.classList.remove('hidden');
                
                // Auto-fill standard dimensions based on vehicle type (in cm and kg)
                const vehicleDimensions = {
                    'car': { length: 450, width: 175, height: 145, weight: 1500 },
                    'suv': { length: 490, width: 195, height: 180, weight: 2000 },
                    'truck': { length: 550, width: 200, height: 190, weight: 2500 },
                    'van': { length: 525, width: 200, height: 205, weight: 2200 },
                    'motorcycle': { length: 210, width: 80, height: 120, weight: 250 },
                    'rv': { length: 750, width: 240, height: 300, weight: 5000 },
                    'boat': { length: 600, width: 240, height: 150, weight: 3500 },
                    'atv': { length: 240, width: 120, height: 120, weight: 350 }
                };
                
                if (vehicleDimensions[packageType]) {
                    const dims = vehicleDimensions[packageType];
                    lengthInput.value = dims.length;
                    widthInput.value = dims.width;
                    heightInput.value = dims.height;
                    weightInput.value = dims.weight;
                    autoDimensionsHelp.classList.remove('hidden');
                    calculateDimensionalWeight();
                    updateCostTotal();
                }
            } else {
                vehicleFields.classList.add('hidden');
                autoDimensionsHelp.classList.add('hidden');
            }
            
            // Heavy equipment might need larger dimensions (in cm and kg)
            if (heavyEquipmentTypes.includes(packageType)) {
                if (!lengthInput.value || lengthInput.value < 300) {
                    lengthInput.placeholder = '300+';
                    widthInput.placeholder = '240+';
                    heightInput.placeholder = '240+';
                    weightInput.placeholder = '2000+';
                }
            }
            
            updateCostTotal();
        }
        
        // Legacy function - kept for compatibility but disabled (costs are now manual)
        function updateCostEstimate() {
            // Disabled - costs are now entered manually
            // Just update the total display from manual inputs
            updateCostTotal();
        }
        
        // Villes du Cameroun par r√©gion
        const cameroonCitiesByRegion = {
            'Adamaoua': ['Ngaound√©r√©', 'Meiganga', 'Tibati', 'Tign√®re', 'Galim', 'Ngaoundal', 'Djohong', 'Nyambaka', 'Touboro'],
            'Centre': ['Yaound√©', 'Mbalmayo', 'Obala', 'Akonolinga', 'Es√©ka', 'Mbandjock', 'Nanga-Eboko', 'Nkoteng', 'Mfou', 'Mbankomo', 'Saa', 'Bafia'],
            'Est': ['Bertoua', 'Batouri', 'Yokadouma', 'Abong-Mbang', 'Garoua-Boula√Ø', 'B√©labo', 'Lomi√©', 'Ndelele', 'Dimako', 'Doum√©'],
            'Extr√™me-Nord': ['Maroua', 'Mokolo', 'Kousseri', 'Mora', 'Ka√©l√©', 'Yagoua', 'Maga', 'Mokolo', 'Guidiguis', 'Bogo', 'Figuil', 'Gazawa', 'Tchollir√©', 'Blangoua', 'Goulfey'],
            'Littoral': ['Douala', 'Ed√©a', 'Nkongsamba', 'Loum', 'Mbanga', 'Yabassi', 'Manjo', 'Melong', 'Dibombari', 'Pouma', 'Dizangu√©'],
            'Nord': ['Garoua', 'Guider', 'Pitoa', 'Lagdo', 'Rey Bouba', 'Poli', 'Tchollir√©'],
            'Nord-Ouest': ['Bamenda', 'Wum', 'Kumbo', 'Nkamb√©', 'Ndop', 'Fundong', 'Bali', 'Batibo', 'Oku'],
            'Ouest': ['Bafoussam', 'Foumban', 'Dschang', 'Mbouda', 'Bangangt√©', 'Bafang', 'Foumbot', 'Koutaba', 'Bana', 'Bandjoun', 'Bangang', 'Bansoa', 'Bazou', 'K√©kem', 'Magba', 'Mak√©n√©n√©', 'Tonga'],
            'Sud': ['Ebolowa', 'Sangm√©lima', 'Kribi', 'Mvengu√©', 'Akom II', 'Lolodorf', 'Ngomedzap', 'Mvangan'],
            'Sud-Ouest': ['Buea', 'Limbe', 'Kumba', 'Tiko', 'Mamfe', 'Muyuka', 'Mundemba', 'Idenau', 'Tombel', 'Mutengene', 'Bekondo', 'Campo', 'Idabato', 'Nguti']
        };

        // Fonction pour remplir les villes selon la r√©gion
        function updateCitiesByRegion(regionSelectId, citySelectId) {
            const regionSelect = document.getElementById(regionSelectId);
            const citySelect = document.getElementById(citySelectId);
            
            if (!regionSelect || !citySelect) return;
            
            // Vider la liste des villes
            citySelect.innerHTML = '<option value="">S√©lectionner une ville</option>';
            
            const selectedRegion = regionSelect.value;
            if (selectedRegion && cameroonCitiesByRegion[selectedRegion]) {
                const cities = cameroonCitiesByRegion[selectedRegion];
                cities.forEach(city => {
                    const option = document.createElement('option');
                    option.value = city;
                    option.textContent = city;
                    citySelect.appendChild(option);
                });
            }
        }

        // Initialiser les √©v√©nements pour les r√©gions
        document.addEventListener('DOMContentLoaded', function() {
            const senderRegion = document.getElementById('sender-region');
            const recipientRegion = document.getElementById('recipient-region');
            
            if (senderRegion) {
                senderRegion.addEventListener('change', () => updateCitiesByRegion('sender-region', 'sender-city'));
            }
            
            if (recipientRegion) {
                recipientRegion.addEventListener('change', () => updateCitiesByRegion('recipient-region', 'recipient-city'));
            }
        });

        // Handle country selection to show/hide state field appropriately
        function handleCountryChange(selectElement, stateField) {
            const selectedCountry = selectElement.value;
            // Cameroon doesn't require state/province field
            const requiresState = false;
            
            if (requiresState) {
                // For countries that need state/province
                if (!stateField.options) {
                    // Convert to select if it's currently a text input
                    const parent = stateField.parentElement;
                    const label = stateField.previousElementSibling;
                    const newSelect = document.createElement('select');
                    newSelect.name = stateField.name;
                    newSelect.className = stateField.className;
                    newSelect.required = true;
                    newSelect.innerHTML = label.cloneNode(true);
                    
                    if (selectedCountry === 'US') {
                        newSelect.innerHTML = `
                            <option value="">Select State</option>
                            <option value="AL">Alabama</option>
                            <option value="AK">Alaska</option>
                            <option value="AZ">Arizona</option>
                            <option value="AR">Arkansas</option>
                            <option value="CA">California</option>
                            <option value="CO">Colorado</option>
                            <option value="CT">Connecticut</option>
                            <option value="DE">Delaware</option>
                            <option value="FL">Florida</option>
                            <option value="GA">Georgia</option>
                            <option value="HI">Hawaii</option>
                            <option value="ID">Idaho</option>
                            <option value="IL">Illinois</option>
                            <option value="IN">Indiana</option>
                            <option value="IA">Iowa</option>
                            <option value="KS">Kansas</option>
                            <option value="KY">Kentucky</option>
                            <option value="LA">Louisiana</option>
                            <option value="ME">Maine</option>
                            <option value="MD">Maryland</option>
                            <option value="MA">Massachusetts</option>
                            <option value="MI">Michigan</option>
                            <option value="MN">Minnesota</option>
                            <option value="MS">Mississippi</option>
                            <option value="MO">Missouri</option>
                            <option value="MT">Montana</option>
                            <option value="NE">Nebraska</option>
                            <option value="NV">Nevada</option>
                            <option value="NH">New Hampshire</option>
                            <option value="NJ">New Jersey</option>
                            <option value="NM">New Mexico</option>
                            <option value="NY">New York</option>
                            <option value="NC">North Carolina</option>
                            <option value="ND">North Dakota</option>
                            <option value="OH">Ohio</option>
                            <option value="OK">Oklahoma</option>
                            <option value="OR">Oregon</option>
                            <option value="PA">Pennsylvania</option>
                            <option value="RI">Rhode Island</option>
                            <option value="SC">South Carolina</option>
                            <option value="SD">South Dakota</option>
                            <option value="TN">Tennessee</option>
                            <option value="TX">Texas</option>
                            <option value="UT">Utah</option>
                            <option value="VT">Vermont</option>
                            <option value="VA">Virginia</option>
                            <option value="WA">Washington</option>
                            <option value="WV">West Virginia</option>
                            <option value="WI">Wisconsin</option>
                            <option value="WY">Wyoming</option>
                            <option value="DC">District of Columbia</option>
                        `;
                    } else if (selectedCountry === 'CA') {
                        newSelect.innerHTML = `
                            <option value="">Select Province</option>
                            <option value="AB">Alberta</option>
                            <option value="BC">British Columbia</option>
                            <option value="MB">Manitoba</option>
                            <option value="NB">New Brunswick</option>
                            <option value="NL">Newfoundland and Labrador</option>
                            <option value="NS">Nova Scotia</option>
                            <option value="NT">Northwest Territories</option>
                            <option value="NU">Nunavut</option>
                            <option value="ON">Ontario</option>
                            <option value="PE">Prince Edward Island</option>
                            <option value="QC">Quebec</option>
                            <option value="SK">Saskatchewan</option>
                            <option value="YT">Yukon</option>
                        `;
                    } else if (selectedCountry === 'MX') {
                        newSelect.innerHTML = `
                            <option value="">Select State</option>
                            <option value="AG">Aguascalientes</option>
                            <option value="BC">Baja California</option>
                            <option value="BS">Baja California Sur</option>
                            <option value="CM">Campeche</option>
                            <option value="CS">Chiapas</option>
                            <option value="CH">Chihuahua</option>
                            <option value="CO">Coahuila</option>
                            <option value="CL">Colima</option>
                            <option value="DF">Mexico City</option>
                            <option value="DG">Durango</option>
                            <option value="GT">Guanajuato</option>
                            <option value="GR">Guerrero</option>
                            <option value="HG">Hidalgo</option>
                            <option value="JA">Jalisco</option>
                            <option value="EM">Mexico State</option>
                            <option value="MI">Michoac√°n</option>
                            <option value="MO">Morelos</option>
                            <option value="NA">Nayarit</option>
                            <option value="NL">Nuevo Le√≥n</option>
                            <option value="OA">Oaxaca</option>
                            <option value="PU">Puebla</option>
                            <option value="QE">Quer√©taro</option>
                            <option value="QR">Quintana Roo</option>
                            <option value="SL">San Luis Potos√≠</option>
                            <option value="SI">Sinaloa</option>
                            <option value="SO">Sonora</option>
                            <option value="TB">Tabasco</option>
                            <option value="TM">Tamaulipas</option>
                            <option value="TL">Tlaxcala</option>
                            <option value="VE">Veracruz</option>
                            <option value="YU">Yucat√°n</option>
                            <option value="ZA">Zacatecas</option>
                        `;
                    } else if (selectedCountry === 'AU') {
                        newSelect.innerHTML = `
                            <option value="">Select State</option>
                            <option value="ACT">Australian Capital Territory</option>
                            <option value="NSW">New South Wales</option>
                            <option value="NT">Northern Territory</option>
                            <option value="QLD">Queensland</option>
                            <option value="SA">South Australia</option>
                            <option value="TAS">Tasmania</option>
                            <option value="VIC">Victoria</option>
                            <option value="WA">Western Australia</option>
                        `;
                    }
                    
                    parent.replaceChild(newSelect, stateField);
                    stateField = newSelect;
                }
                stateField.required = true;
                stateField.parentElement.querySelector('label').innerHTML = stateField.parentElement.querySelector('label').innerHTML.replace('(optional)', '');
            } else {
                // For countries that don't need state
                if (stateField.options) {
                    // Convert to text input if it's currently a select
                    const parent = stateField.parentElement;
                    const label = stateField.previousElementSibling;
                    const newInput = document.createElement('input');
                    newInput.type = 'text';
                    newInput.name = stateField.name;
                    newInput.className = stateField.className;
                    newInput.placeholder = selectedCountry === 'GB' ? 'County (optional)' : 'State/Province (optional)';
                    parent.replaceChild(newInput, stateField);
                    stateField = newInput;
                }
                stateField.required = false;
                const label = stateField.parentElement.querySelector('label');
                if (!label.textContent.includes('optional')) {
                    label.innerHTML = label.innerHTML + ' <span class="text-text-muted">(optional)</span>';
                }
            }
        }
        
        // Add event listeners for real-time calculations
        document.addEventListener('DOMContentLoaded', function() {
            const dimensionInputs = document.querySelectorAll('#length-input, #width-input, #height-input, #weight-input');
            dimensionInputs.forEach(input => {
                input.addEventListener('input', () => {
                    calculateDimensionalWeight();
                    // Costs are now manual, no need to recalculate
                });
            });
            
            // Listen to cost input changes to update total
            const costBaseInput = document.getElementById('cost-base');
            const costShippingInput = document.getElementById('cost-shipping');
            const costInsuranceInput = document.getElementById('cost-insurance');
            
            if (costBaseInput) costBaseInput.addEventListener('input', updateCostTotal);
            if (costShippingInput) costShippingInput.addEventListener('input', updateCostTotal);
            if (costInsuranceInput) costInsuranceInput.addEventListener('input', updateCostTotal);
            
            // Initialize city dropdowns based on regions
            const senderRegion = document.getElementById('sender-region');
            const recipientRegion = document.getElementById('recipient-region');
            
            if (senderRegion) {
                senderRegion.addEventListener('change', () => updateCitiesByRegion('sender-region', 'sender-city'));
            }
            
            if (recipientRegion) {
                recipientRegion.addEventListener('change', () => updateCitiesByRegion('recipient-region', 'recipient-city'));
            }
            
            // Initialize
            calculateDimensionalWeight();
            updateCostTotal();
        });
        
        // File upload handling
        document.getElementById('file-upload').addEventListener('change', function(e) {
            const files = Array.from(e.target.files);
            if (files.length > 0) {
                const fileNames = files.map(f => f.name).join(', ');
                alert(`Selected files: ${fileNames}`);
            }
        });
        
        // Address validation - Appel API r√©el (√† impl√©menter avec un service de validation)
        async function validateAddress(input) {
            const address = input.value.trim();
            if (!address || address.length < 5) {
                input.classList.remove('border-success', 'border-error');
                return;
            }
            
            // Pour l'instant, validation basique c√¥t√© client
            // Plus tard, int√©grer avec un service comme Google Maps API ou SmartyStreets
            try {
                // Simuler une validation
            setTimeout(() => {
                    if (address.length >= 10) {
                input.classList.add('border-success');
                        input.classList.remove('border-error');
                console.log('Address validated');
                    } else {
                        input.classList.add('border-error');
                        input.classList.remove('border-success');
                    }
            }, 1000);
            } catch (error) {
                console.error('Address validation error:', error);
            }
        }
        
        // Add address validation to street address fields
        document.querySelectorAll('input[placeholder*="Street"]').forEach(input => {
            input.addEventListener('blur', () => validateAddress(input));
        });
        
        // Check authentication - allow everyone to create shipments (optional)
        async function checkCreateShipmentAccess() {
            try {
                const response = await fetch('/api/auth/me', { credentials: 'include' });
                if (response.ok) {
                    const data = await response.json();
                    
                    // Allow access to everyone (admins and non-admins)
                    // The API will handle permissions if needed
                    if (data.user) {
                        console.log('‚úÖ User logged in:', data.user.email, 'Role:', data.user.role);
                    } else {
                        console.log('‚úÖ Public access - shipment creation allowed');
                    }
                } else {
                    // Allow public access even if auth check fails
                    console.log('‚úÖ Public access - shipment creation allowed');
                }
            } catch (error) {
                // Allow public access even if there's an error
                console.log('‚úÖ Public access - shipment creation allowed (auth check failed)');
            }
            
            // Ensure the create button is visible
            const createBtn = document.getElementById('create-shipment-btn');
            if (createBtn) {
                createBtn.style.display = 'flex';
                createBtn.style.visibility = 'visible';
                createBtn.style.opacity = '1';
                console.log('‚úÖ Create shipment button is visible');
            } else {
                console.warn('‚ö†Ô∏è Create shipment button not found in DOM');
            }
        }
        
        // Run auth check on page load
        checkCreateShipmentAccess();
        
        // Also ensure button visibility after DOM is fully loaded
        document.addEventListener('DOMContentLoaded', function() {
            const createBtn = document.getElementById('create-shipment-btn');
            if (createBtn) {
                createBtn.style.display = 'flex';
                createBtn.style.visibility = 'visible';
                createBtn.style.opacity = '1';
                console.log('‚úÖ Create shipment button verified on DOMContentLoaded');
            }
        });
    </script>
<script id="dhws-data-injector" src="../public/dhws-data-injector.js"></script>
</body>
</html>
